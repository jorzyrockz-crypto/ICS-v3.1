<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ICS V3 - Dashboard Shell</title>
<meta name="theme-color" content="#2563eb" />
<link rel="manifest" href="./manifest.webmanifest" />
<link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192.png" />
<link rel="apple-touch-icon" href="./icons/icon-192.png" />
<style>
:root{
  --a:#2563eb;
  --as:#eaf1ff;
  --ah:#1d4ed8;
  --bg:#f3f6fb;
  --m:#eef2f7;
  --t:#0f172a;
  --tm:#64748b;
  --border:#dbe3ef;
  --surface:#ffffff;
  --surface-soft:#f8fbff;
  --sidebar-bg:linear-gradient(180deg,#ffffff 0%,#f8fbff 100%);
  --topbar-bg:rgba(255,255,255,.9);
  --icon-btn-bg:#ffffff;
  --icon-btn-text:#475569;
  --icon-btn-border:var(--border);
  --modal-bg:#ffffff;
  --modal-border:#dbeafe;
  --modal-head-bg:linear-gradient(180deg,#fbfdff 0%,#f5f9ff 100%);
  --modal-head-border:#e5edf7;
  --modal-foot-bg:rgba(255,255,255,.96);
  --modal-foot-border:#e5edf7;
  --btn-add-bg:var(--as);
  --btn-add-text:var(--ah);
  --btn-primary-bg:var(--a);
  --btn-primary-text:#ffffff;
  --btn-del-bg:#fee2e2;
  --btn-del-text:#b91c1c;
  --btn-secondary-bg:var(--m);
  --btn-secondary-text:var(--t);
  --sheet-bg:linear-gradient(160deg,#ecf4ff 0%,#dbeafe 100%);
  --sheet-border:#93c5fd;
  --sheet-shadow:0 14px 30px rgba(30,64,175,.28);
  --sheet-heading:#1d4ed8;
  --sheet-label:#1e3a8a;
  --sheet-input-bg:#f8fbff;
  --sheet-input-border:#93c5fd;
  --sheet-input-text:#0f172a;
  --sheet-input-placeholder:#94a3b8;
  --sheet-input-focus-border:var(--a);
  --sheet-input-focus-ring:0 0 0 2px rgba(59,130,246,.25);
  --fab-focus-ring:0 0 0 3px rgba(191,219,254,.9),0 10px 22px rgba(37,99,235,.34);
  --r1:18px;
  --r2:12px;
  --r3:9px;
  --sh:0 10px 28px rgba(15,23,42,.08);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Manrope,"Plus Jakarta Sans","Segoe UI",sans-serif;
  background:
    radial-gradient(1200px 520px at 0% -10%, #dbeafe 0%, rgba(219,234,254,0) 58%),
    radial-gradient(1000px 480px at 100% -5%, #e0f2fe 0%, rgba(224,242,254,0) 50%),
    var(--bg);
  color:var(--t);
}
body[data-theme="playful"]{
  background:
    radial-gradient(1200px 520px at 0% -10%, #fde68a 0%, rgba(253,230,138,0) 58%),
    radial-gradient(1000px 480px at 100% -5%, #bfdbfe 0%, rgba(191,219,254,0) 50%),
    var(--bg);
}
body[data-theme="elegant-white"]{
  background:
    radial-gradient(1200px 520px at 0% -10%, #eef2ff 0%, rgba(238,242,255,0) 58%),
    radial-gradient(1000px 480px at 100% -5%, #f1f5f9 0%, rgba(241,245,249,0) 50%),
    var(--bg);
}
body[data-theme="crimson-black"]{
  background:
    radial-gradient(1200px 520px at 0% -10%, rgba(127,29,29,.6) 0%, rgba(127,29,29,0) 58%),
    radial-gradient(1000px 480px at 100% -5%, rgba(136,19,55,.4) 0%, rgba(136,19,55,0) 50%),
    #0b0b10;
}
body[data-theme="nord"]{
  background:
    radial-gradient(1200px 520px at 0% -10%, #90c2e7 0%, rgba(144,194,231,0) 58%),
    radial-gradient(1000px 480px at 100% -5%, #cdd4dd 0%, rgba(205,212,221,0) 50%),
    #22819a;
}
body[data-theme="dracula"]{
  background:
    radial-gradient(1200px 520px at 0% -10%, #6f2dbd 0%, rgba(111,45,189,0) 58%),
    radial-gradient(1000px 480px at 100% -5%, #a663cc 0%, rgba(166,99,204,0) 50%),
    #171123;
}
body[data-theme="elegant-green"]{
  background:
    radial-gradient(1200px 520px at 0% -10%, #a7aa63 0%, rgba(167,170,99,0) 58%),
    radial-gradient(1000px 480px at 100% -5%, #eae6d2 0%, rgba(234,230,210,0) 50%),
    #a7aa63;
}
body[data-theme="velvet-red"]{
  background:
    radial-gradient(1200px 520px at 0% -10%, #fee2e2 0%, rgba(254,226,226,0) 58%),
    radial-gradient(1000px 480px at 100% -5%, #ffe4e6 0%, rgba(255,228,230,0) 50%),
    #fff8f8;
}
body[data-theme="crimson-black"] .app-sidebar,
body[data-theme="crimson-black"] .app-topbar,
body[data-theme="crimson-black"] .ics-card,
body[data-theme="crimson-black"] .actions-modal,
body[data-theme="crimson-black"] .modal,
body[data-theme="crimson-black"] .search-box{
  color:#e2e8f0;
  border-color:#3a1f27;
  box-shadow:0 16px 34px rgba(0,0,0,.45);
}
body[data-theme="dracula"] .app-sidebar,
body[data-theme="dracula"] .app-topbar,
body[data-theme="dracula"] .ics-card,
body[data-theme="dracula"] .actions-modal,
body[data-theme="dracula"] .modal,
body[data-theme="dracula"] .search-box{
  color:#e2e8f0;
  border-color:#3d3156;
  box-shadow:0 16px 34px rgba(0,0,0,.45);
}
body[data-theme="dracula"] .app-sidebar{background:linear-gradient(180deg,#1a1730 0%,#201a36 100%)}
body[data-theme="dracula"] .app-topbar{background:rgba(26,23,48,.9)}
body[data-theme="dracula"] .ics-card,
body[data-theme="dracula"] .actions-modal,
body[data-theme="dracula"] .modal,
body[data-theme="dracula"] .search-box{background:#1c1730}
body[data-theme="dracula"] .card-subtext,
body[data-theme="dracula"] .dash-note,
body[data-theme="dracula"] .modal-sub,
body[data-theme="dracula"] .search-empty,
body[data-theme="dracula"] .search-item-meta{
  color:#b8c1d8;
}
body[data-theme="dracula"] .ics-table th,
body[data-theme="dracula"] .detail-table thead th{
  background:#241f3b;
  color:#d8def0;
}
body[data-theme="dracula"] .records .ics-table tbody tr:nth-child(even){background:#1f1934}
body[data-theme="dracula"] .records .ics-table tbody tr:hover{background:#2a2142}
body[data-theme="dracula"] .stage-input,
body[data-theme="dracula"] .search-input{
  background:#171329;
  border-color:#4b3f6d;
  color:#f8fafc;
}
body[data-theme="crimson-black"] .app-sidebar{background:linear-gradient(180deg,#140f16 0%,#1a1118 100%)}
body[data-theme="crimson-black"] .app-topbar{background:rgba(20,15,22,.92)}
body[data-theme="crimson-black"] .ics-card,
body[data-theme="crimson-black"] .actions-modal,
body[data-theme="crimson-black"] .modal,
body[data-theme="crimson-black"] .search-box{background:#17111a}
body[data-theme="crimson-black"] .card-subtext,
body[data-theme="crimson-black"] .dash-note,
body[data-theme="crimson-black"] .modal-sub,
body[data-theme="crimson-black"] .search-empty,
body[data-theme="crimson-black"] .search-item-meta{
  color:#94a3b8;
}
body[data-theme="crimson-black"] .ics-table th,
body[data-theme="crimson-black"] .detail-table thead th{
  background:#1f1722;
  color:#cbd5e1;
}
body[data-theme="crimson-black"] .records .ics-table tbody tr:nth-child(even){background:#18121d}
body[data-theme="crimson-black"] .records .ics-table tbody tr:hover{background:#231826}
body[data-theme="crimson-black"] .stage-input,
body[data-theme="crimson-black"] .search-input{
  background:#120d14;
  border-color:#4b2a33;
  color:#f8fafc;
}
body[data-theme="crimson-black"] .dash-kpi{
  background:linear-gradient(180deg,#18131a 0%,#221722 100%);
  border-color:#3a1f27;
}
body[data-theme="crimson-black"] .dash-kpi .k,
body[data-theme="crimson-black"] .dash-kpi-sub{color:#94a3b8}
body[data-theme="crimson-black"] .dash-kpi .v{color:#f8fafc}

/* Top navigation - SaaS style */
.app-shell{
  min-height:100vh;
  display:grid;
  grid-template-columns:246px 1fr;
  gap:16px;
  padding:14px;
}
.app-sidebar{
  position:sticky;
  top:14px;
  height:calc(100vh - 28px);
  border:1px solid var(--border);
  border-radius:var(--r1);
  background:var(--sidebar-bg);
  box-shadow:var(--sh);
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.brand{display:flex;align-items:center;gap:10px;padding:8px 8px 10px}
.logo{
  width:36px;
  height:36px;
  border-radius:11px;
  background:linear-gradient(145deg,var(--a) 0%,var(--ah) 100%);
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  color:#fff;
  display:grid;
  place-items:center;
  font-size:11px;
  font-weight:800;
  letter-spacing:.06em;
}
.logo.has-image{
  color:transparent;
  text-shadow:none;
}
.brand-copy{display:flex;flex-direction:column}
.brand-title{font-size:13px;font-weight:800;line-height:1.1}
.brand-sub{font-size:11px;color:var(--tm);font-weight:600;line-height:1.1}
.sidebar-nav{display:flex;flex-direction:column;gap:6px}
.sidebar-nav .item{
  display:flex;
  align-items:center;
  gap:10px;
  padding:9px 10px;
  border-radius:10px;
  font-size:12px;
  font-weight:700;
  color:#334155;
  cursor:pointer;
  transition:.16s ease;
}
.sidebar-nav .item:hover{background:var(--as);color:var(--ah)}
.sidebar-nav .item.active{
  background:linear-gradient(135deg,var(--a) 0%,var(--ah) 100%);
  color:#fff;
  box-shadow:0 8px 20px rgba(15,23,42,.26);
}
.nav-ico{
  width:17px;
  height:17px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}
.nav-ico svg{width:17px;height:17px;fill:currentColor}
.sidebar-foot{
  margin-top:auto;
  padding:10px 8px 6px;
  border-top:1px solid #e7edf6;
}
.sidebar-install{
  margin-bottom:8px;
}
.sidebar-install-btn{
  width:100%;
  justify-content:center;
}
.sidebar-profile{
  display:grid;
  gap:8px;
  border:1px solid #dbe3ef;
  border-radius:12px;
  padding:10px;
  background:rgba(255,255,255,.72);
}
.sidebar-profile-main{
  display:flex;
  align-items:center;
  gap:8px;
  justify-content:space-between;
}
.sidebar-profile-avatar{
  width:34px;
  height:34px;
  border-radius:10px;
  background:linear-gradient(145deg,var(--a) 0%,var(--ah) 100%);
  color:#fff;
  display:grid;
  place-items:center;
  font-size:11px;
  font-weight:800;
  letter-spacing:.04em;
}
.sidebar-profile-left{
  display:flex;
  align-items:center;
  gap:8px;
  min-width:0;
}
.sidebar-profile-identity{
  border:none;
  background:transparent;
  padding:0;
  text-align:left;
  cursor:pointer;
  min-width:0;
}
.sidebar-profile-name{
  font-size:12px;
  font-weight:800;
  color:var(--t);
  line-height:1.1;
}
.sidebar-profile-role{
  font-size:11px;
  color:var(--tm);
  line-height:1.1;
  margin-top:2px;
}
.sidebar-signout-icon{
  width:30px;
  height:30px;
  border-radius:9px;
  border:1px solid var(--icon-btn-border);
  background:var(--icon-btn-bg);
  color:var(--btn-del-text);
  display:grid;
  place-items:center;
  cursor:pointer;
}
.sidebar-signout-icon svg{
  width:15px;
  height:15px;
  fill:currentColor;
}
.app-main{
  min-width:0;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.app-topbar{
  position:sticky;
  top:14px;
  z-index:100;
  height:58px;
  border:1px solid var(--border);
  border-radius:14px;
  background:var(--topbar-bg);
  backdrop-filter:blur(8px);
  box-shadow:var(--sh);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 14px 0 16px;
}
.topbar-title{
  font-size:13px;
  font-weight:800;
  letter-spacing:.02em;
  color:var(--t);
}
.right{display:flex;align-items:center;gap:10px;font-size:12px;color:var(--tm)}
.top-user-meta{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  min-width:140px;
  line-height:1.15;
}
.top-user-name{
  font-size:12px;
  font-weight:800;
  color:var(--t);
}
.top-user-role{
  font-size:10px;
  color:var(--tm);
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:.05em;
}
.icon-btn{
  width:34px;
  height:34px;
  border-radius:10px;
  border:1px solid var(--icon-btn-border);
  background:var(--icon-btn-bg);
  color:var(--icon-btn-text);
  display:grid;
  place-items:center;
  cursor:pointer;
  transition:.15s;
}
.icon-btn:hover{background:var(--as);color:var(--ah);border-color:#bfdbfe}
.icon-btn svg{width:16px;height:16px;fill:currentColor}
.search-overlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,.35);
  backdrop-filter:blur(3px);
  display:none;
  align-items:flex-start;
  justify-content:center;
  padding-top:80px;
  z-index:140;
}
.search-overlay.show{display:flex}
.search-box{
  width:min(760px,94vw);
  background:#fff;
  border:1px solid #e2e8f0;
  border-radius:14px;
  box-shadow:0 20px 40px rgba(15,23,42,.2);
  overflow:hidden;
}
.search-input{
  width:100%;
  border:0;
  border-bottom:1px solid #e2e8f0;
  padding:12px 14px;
  font-size:14px;
}
.search-input:focus{outline:none}
.search-results{
  max-height:360px;
  overflow:auto;
}
.search-empty{
  padding:12px 14px;
  color:var(--tm);
  font-size:12px;
}
.search-item{
  border:0;
  background:#fff;
  width:100%;
  text-align:left;
  padding:10px 14px;
  border-bottom:1px solid #f1f5f9;
  cursor:pointer;
}
.search-item:hover,
.search-item.active{background:#eff6ff}
.search-item-title{font-size:13px;font-weight:700;color:var(--t)}
.search-item-meta{font-size:11px;color:var(--tm);margin-top:2px}
.search-item-type{
  display:inline-block;
  margin-left:6px;
  padding:1px 6px;
  border-radius:999px;
  font-size:10px;
  font-weight:700;
  color:#475569;
  background:#e2e8f0;
}
.welcome-banner{
  position:relative;
  border:1px solid #dbeafe;
  border-radius:16px;
  background:linear-gradient(135deg,#f8fbff 0%,#eef6ff 55%,#ffffff 100%);
  box-shadow:0 12px 24px rgba(15,23,42,.08);
  padding:16px 18px;
  overflow:hidden;
  margin-bottom:12px;
}
.welcome-banner::before{
  content:'';
  position:absolute;
  inset:auto -40px -55px auto;
  width:220px;
  height:220px;
  border-radius:50%;
  background:radial-gradient(circle,#bfdbfe 0%,rgba(191,219,254,0) 70%);
  pointer-events:none;
}
.welcome-badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:4px 10px;
  border:1px solid #bfdbfe;
  border-radius:999px;
  background:#ffffffc7;
  color:#475569;
  font-size:10px;
  font-weight:700;
  letter-spacing:.12em;
  text-transform:uppercase;
}
.welcome-badge .dot{
  width:6px;height:6px;border-radius:999px;background:#22c55e;display:inline-block;
  box-shadow:0 0 0 4px rgba(34,197,94,.18);
}
.welcome-title{
  margin:10px 0 2px;
  font-size:30px;
  line-height:1.1;
  font-weight:900;
  letter-spacing:-.02em;
  color:#0f172a;
}
.welcome-icon{
  display:inline-block;
  transform-origin:50% 70%;
  animation:welcomeIconFloat 2.2s ease-in-out infinite;
}
@keyframes welcomeIconFloat{
  0%,100%{transform:translateY(0) rotate(0deg)}
  30%{transform:translateY(-2px) rotate(-5deg)}
  65%{transform:translateY(-1px) rotate(4deg)}
}
.welcome-subtitle{
  margin:0;
  color:#475569;
  font-size:14px;
  max-width:760px;
}
.actions-hero{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.actions-kpis{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin:12px 0 16px;
}
.actions-kpi{
  border:1px solid #e2e8f0;
  border-radius:10px;
  padding:10px;
  background:#fff;
}
.actions-kpi .label{font-size:11px;color:var(--tm)}
.actions-kpi .value{font-size:24px;font-weight:700}
.actions-kpi.crit{background:#fef2f2}
.actions-kpi.warn{background:#fffbeb}
.actions-kpi.good{background:#f0fdf4}
.actions-modal-overlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,.4);
  backdrop-filter:blur(3px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:145;
}
.actions-modal-overlay.show{display:flex}
.actions-modal{
  width:min(1100px,96vw);
  max-height:88vh;
  overflow:hidden;
  background:var(--modal-bg);
  border:1px solid var(--modal-border);
  border-radius:16px;
  box-shadow:0 24px 42px rgba(15,23,42,.25);
  display:flex;
  flex-direction:column;
}
.setup-overlay{
  background:rgba(2,6,23,.96);
  backdrop-filter:none;
}
.setup-modal{
  width:min(620px,94vw);
  border:2px solid transparent;
  background:
    linear-gradient(180deg,#0b1220 0%,#101a2f 100%) padding-box,
    linear-gradient(120deg,#22d3ee,#3b82f6,#22c55e,#3b82f6,#22d3ee) border-box;
  background-size:100% 100%,300% 300%;
  animation:setupBorderMove 8s linear infinite;
  color:#e2e8f0;
}
.setup-modal .modal-head{
  background:rgba(15,23,42,.88);
  border-bottom:1px solid rgba(56,189,248,.35);
}
.setup-modal .modal-foot{
  background:rgba(15,23,42,.9);
  border-top:1px solid rgba(56,189,248,.35);
}
.setup-modal .modal-sub,
.setup-modal .dm-muted{color:#93c5fd}
.setup-modal label{color:#cbd5e1}
.setup-modal .stage-input{
  background:rgba(15,23,42,.72);
  border-color:#334155;
  color:#f8fafc;
}
.setup-modal .stage-input::placeholder{color:#94a3b8}
.setup-modal .profile-section{
  background:rgba(15,23,42,.58);
  border-color:#334155;
}
.setup-modal .profile-section-title{color:#bfdbfe}
.setup-hint{
  margin:8px 0 0;
  font-size:12px;
  color:#93c5fd;
}
.setup-hint.error{color:#fca5a5}
.setup-hint.success{color:#86efac}
@keyframes setupBorderMove{
  0%{background-position:0 0,0% 50%}
  50%{background-position:0 0,100% 50%}
  100%{background-position:0 0,0% 50%}
}
.modal-sm{width:min(520px,94vw)}
.modal-md{width:min(620px,95vw)}
.modal-lg{width:min(980px,97vw)}
.modal-xl{width:min(1120px,98vw)}
.modal-head{
  padding:14px 16px 12px;
  border-bottom:1px solid var(--modal-head-border);
  background:var(--modal-head-bg);
}
.modal-head h3{
  margin:0;
  font-size:17px;
  font-weight:800;
}
.modal-sub{
  margin:6px 0 0;
  font-size:12px;
  color:#64748b;
}
.modal-body{
  padding:14px 16px;
  overflow:auto;
}
.modal-foot{
  padding:10px 16px;
  border-top:1px solid var(--modal-foot-border);
  background:var(--modal-foot-bg);
  backdrop-filter:blur(5px);
  position:sticky;
  bottom:0;
  z-index:2;
}
.modal-foot .ics-card-actions{
  margin-top:0;
}
.modal-toast{
  position:absolute;
  top:12px;
  left:50%;
  transform:translateX(-50%);
  min-width:280px;
  max-width:min(88vw,720px);
  border-radius:10px;
  padding:10px 12px;
  font-size:12px;
  font-weight:700;
  box-shadow:0 12px 24px rgba(15,23,42,.2);
  border:1px solid #cbd5e1;
  z-index:200;
}
.modal-toast.success{background:#f0fdf4;color:#166534;border-color:#86efac}
.modal-toast.error{background:#fef2f2;color:#991b1b;border-color:#fecaca}
.modal-toast.warn{background:#fffbeb;color:#92400e;border-color:#fde68a}
.modal-toast.info{background:#eff6ff;color:#1d4ed8;border-color:#bfdbfe}
.login-hint{
  font-size:12px;
  color:#64748b;
  margin:8px 0 0;
}
.login-hint.error{color:#b91c1c}
.login-hint.success{color:#166534}
.data-manager-bar{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
  margin:0;
}
.dm-layout{display:grid;gap:12px}
.dm-layout-top{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  align-items:start;
}
.dm-section{
  border:1px solid #dbe3ef;
  border-radius:12px;
  background:linear-gradient(180deg,#ffffff 0%,#f8fbff 100%);
  padding:10px;
}
.dm-section-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:8px;
}
.dm-section-head h4{
  margin:0;
  font-size:13px;
  color:#0f172a;
}
.dm-step-mark{
  display:none;
  font-size:11px;
  font-weight:800;
  letter-spacing:.2px;
  text-transform:uppercase;
  border-radius:999px;
  padding:4px 8px;
  border:1px solid #86efac;
  background:#f0fdf4;
  color:#166534;
}
.dm-step-mark.show{display:inline-flex;align-items:center}
.dm-section-head p{
  margin:0;
  font-size:11px;
  color:#64748b;
}
.data-manager-file{
  flex:1;
  min-width:220px;
  border:1px dashed #cbd5e1;
  border-radius:10px;
  padding:8px 10px;
  font-size:12px;
  color:#334155;
  background:#f8fafc;
}
.data-manager-mode{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin:0 0 10px;
}
.data-manager-mode label{
  display:inline-flex;
  gap:6px;
  align-items:center;
  border:1px solid #cbd5e1;
  border-radius:999px;
  padding:6px 10px;
  font-size:12px;
  font-weight:700;
  color:#334155;
  background:#fff;
}
.dm-kpis{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:8px;
  margin:10px 0;
}
.dm-kpi{
  border:1px solid #dbe3ef;
  border-radius:10px;
  padding:8px;
  background:#fff;
}
.dm-kpi .k{
  font-size:10px;
  text-transform:uppercase;
  letter-spacing:.3px;
  color:#64748b;
}
.dm-kpi .v{
  font-size:17px;
  font-weight:800;
  color:#0f172a;
  margin-top:2px;
}
.dm-kpi.warn{background:#fffbeb;border-color:#fde68a}
.dm-kpi.err{background:#fef2f2;border-color:#fecaca}
.dm-preview-table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}
.dm-preview-table th,.dm-preview-table td{
  border-bottom:1px solid #e2e8f0;
  padding:7px 6px;
  text-align:left;
}
.dm-preview-table th{
  font-size:11px;
  color:#64748b;
  background:#f8fafc;
}
.dm-muted{
  font-size:12px;
  color:#64748b;
}
.data-manager-export-filters{
  display:flex;
  gap:8px;
  align-items:flex-end;
  flex-wrap:wrap;
}
.data-manager-export-filters label{
  display:flex;
  flex-direction:column;
  gap:4px;
  font-size:11px;
  color:#475569;
  font-weight:700;
}
.data-manager-export-filters .stage-input{
  min-width:150px;
}
.dm-export-actions{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:8px;
}
.dm-foot-actions{
  display:flex;
  width:100%;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}
.dm-foot-left,.dm-foot-right{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.dm-switch-btn{
  background:linear-gradient(135deg,var(--a) 0%,var(--ah) 100%);
  color:#fff !important;
  border:1px solid rgba(255,255,255,.22);
  box-shadow:0 8px 18px rgba(37,99,235,.28);
  font-weight:800;
}
.dm-switch-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 12px 24px rgba(37,99,235,.34);
}
.dm-inline-status{
  margin:0 0 10px;
  padding:8px 10px;
  border-radius:8px;
  font-size:12px;
  font-weight:700;
  display:none;
}
.dm-inline-status.show{display:block}
.dm-inline-status.success{background:#f0fdf4;border:1px solid #86efac;color:#166534}
.dm-inline-status.error{background:#fef2f2;border:1px solid #fecaca;color:#991b1b}
.dm-inline-status.info{background:#eff6ff;border:1px solid #bfdbfe;color:#1d4ed8}
.dm-verify-panel{
  margin:8px 0 10px;
  border-radius:10px;
  border:1px solid #cbd5e1;
  background:#f8fafc;
  color:#334155;
  padding:9px 10px;
  font-size:12px;
  font-weight:700;
}
.dm-verify-panel.success{background:#f0fdf4;border-color:#86efac;color:#166534}
.dm-verify-panel.error{background:#fef2f2;border-color:#fecaca;color:#991b1b}
.dm-verify-panel.warn{background:#fffbeb;border-color:#fde68a;color:#92400e}
.dm-verify-panel.info{background:#eff6ff;border-color:#bfdbfe;color:#1d4ed8}
.dm-verify-meta{
  display:block;
  margin-top:5px;
  font-weight:600;
  font-size:11px;
  word-break:break-all;
  color:inherit;
  opacity:.95;
}
.dm-history-list{
  margin:0;
  padding-left:18px;
  display:grid;
  gap:6px;
}
.dm-history-list li{
  font-size:12px;
  color:#334155;
}
.dm-history-time{
  color:#64748b;
  font-size:11px;
}
.ics-no-wrap{
  display:flex;
  align-items:center;
  width:100%;
}
.ics-no-line{
  display:flex;
  align-items:center;
  gap:6px;
  width:100%;
  min-width:0;
}
.ics-status-dot{
  display:inline-flex;
  justify-content:center;
  align-items:center;
  width:16px;
  height:16px;
  border-radius:50%;
  border:1px solid transparent;
  font-size:10px;
  font-weight:900;
  line-height:1;
  cursor:help;
  flex-shrink:0;
}
.ics-status-dot.new{background:#e0f2fe;border-color:#7dd3fc;color:#0c4a6e}
.ics-status-dot.imported{background:#dcfce7;border-color:#86efac;color:#14532d}
.ics-status-dot.updated{background:#fef3c7;border-color:#fcd34d;color:#78350f}
.dm-hub-actions{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.dm-hub-btn{
  text-align:left;
  border:1px solid #cbd5e1;
  border-radius:12px;
  background:#fff;
  padding:12px;
  cursor:pointer;
}
.dm-hub-ico{
  width:30px;
  height:30px;
  border-radius:8px;
  display:grid;
  place-items:center;
  margin-bottom:8px;
}
.dm-hub-ico svg{width:18px;height:18px;fill:currentColor}
.dm-hub-ico.import{background:#e0f2fe;color:#0369a1}
.dm-hub-ico.export{background:#dcfce7;color:#166534}
.dm-hub-btn strong{display:block;font-size:13px;color:#0f172a}
.dm-hub-btn span{display:block;font-size:11px;color:#64748b;margin-top:4px}
@media (max-width:640px){
  .dm-layout-top{grid-template-columns:1fr}
  .dm-section-head{flex-direction:column;align-items:flex-start}
  .dm-hub-actions{grid-template-columns:1fr}
}
.actions-table{width:100%;border-collapse:collapse;font-size:12px}
.actions-table th,.actions-table td{border-bottom:1px solid #e2e8f0;padding:8px 6px;text-align:left}
.actions-table th{text-transform:none;color:#475569;font-size:11px}
.dash-grid{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:12px;margin:12px 0 16px}
.dash-kpi{
  border:1px solid #cbd5e1;
  border-radius:14px;
  background:linear-gradient(180deg,#ffffff 0%,#f8fafc 100%);
  padding:12px;
  box-shadow:0 6px 14px rgba(15,23,42,.06);
  position:relative;
  overflow:hidden;
}
.dash-kpi-btn{
  width:100%;
  text-align:left;
  cursor:pointer;
  border:1px solid #cbd5e1;
  transition:transform .18s ease, box-shadow .2s ease;
}
.dash-kpi-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 20px rgba(15,23,42,.1);
}
.dash-kpi::before{
  content:'';
  position:absolute;
  left:0;top:0;bottom:0;
  width:4px;
  background:#60a5fa;
}
.dash-kpi .k{font-size:11px;color:#64748b;text-transform:uppercase;letter-spacing:.35px}
.dash-kpi .v{font-size:24px;font-weight:800;color:#0f172a;line-height:1.2;margin-top:4px}
.dash-kpi.warn{background:linear-gradient(180deg,#fffdf2 0%,#fffbeb 100%)}
.dash-kpi.warn::before{background:#f59e0b}
.dash-kpi.danger{background:linear-gradient(180deg,#fff5f5 0%,#fef2f2 100%)}
.dash-kpi.danger::before{background:#ef4444}
.dash-kpi.good{background:linear-gradient(180deg,#f4fff8 0%,#f0fdf4 100%)}
.dash-kpi.good::before{background:#16a34a}
.dash-panels{display:grid;grid-template-columns:1.2fr 1fr;gap:14px}
.dash-chipbar{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 0}
.dash-chip{
  border:1px solid #cbd5e1;
  background:#fff;
  color:var(--tm);
  border-radius:999px;
  padding:5px 10px;
  font-size:11px;
  font-weight:700;
  cursor:pointer;
  transition:background .16s ease, border-color .16s ease, transform .16s ease;
}
.dash-chip:hover{background:#eff6ff;border-color:#93c5fd;transform:translateY(-1px)}
.dash-list{margin:0;padding-left:18px}
.dash-list li{margin:7px 0;color:#334155;font-size:12px}
.dash-actions{display:flex;flex-wrap:wrap;gap:8px}
.dash-actions .small-btn{box-shadow:0 4px 10px rgba(15,23,42,.08)}
.dash-2col{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px}
.dash-note{font-size:11px;color:#64748b}
.dash-empty{
  border:1px dashed #cbd5e1;
  border-radius:12px;
  padding:12px;
  background:#f8fafc;
  margin-top:12px;
}
.dash-story{
  display:grid;
  grid-template-columns:1.45fr 1fr;
  gap:14px;
  margin:6px 0 14px;
}
.dash-hero{
  border:1px solid #bfdbfe;
  border-radius:16px;
  background:linear-gradient(140deg,#f8fbff 0%,#eef4ff 48%,#ffffff 100%);
  box-shadow:0 12px 24px rgba(15,23,42,.08);
  padding:14px;
  position:relative;
  overflow:hidden;
}
.dash-hero::before{
  content:'';
  position:absolute;
  right:-84px;
  top:-84px;
  width:220px;
  height:220px;
  border-radius:50%;
  background:radial-gradient(circle,#bfdbfe 0%,rgba(191,219,254,0) 72%);
  pointer-events:none;
}
.dash-hero-top{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:10px;
}
.dash-hero-kicker{
  font-size:10px;
  color:#475569;
  font-weight:800;
  letter-spacing:.14em;
  text-transform:uppercase;
}
.dash-hero h3{
  margin:6px 0 4px;
  font-size:20px;
  line-height:1.2;
  color:#0f172a;
}
.dash-hero p{
  margin:0;
  font-size:12px;
  color:#475569;
}
.dash-hero-graphic{
  width:150px;
  min-width:150px;
  height:96px;
}
.dash-hero-graphic svg{
  width:100%;
  height:100%;
  display:block;
}
.dash-mini-metrics{
  margin-top:12px;
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  gap:8px;
}
.dash-mini{
  border:1px solid #dbeafe;
  border-radius:10px;
  background:#ffffffc9;
  padding:8px 10px;
}
.dash-mini .k{
  font-size:10px;
  color:#64748b;
  text-transform:uppercase;
  letter-spacing:.06em;
}
.dash-mini .v{
  margin-top:4px;
  font-size:15px;
  font-weight:800;
  color:#0f172a;
}
.dash-health{
  border:1px solid #dbeafe;
  border-radius:16px;
  background:#fff;
  box-shadow:0 10px 22px rgba(15,23,42,.06);
  padding:12px;
}
.dash-health-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
.dash-health-title{
  font-size:12px;
  font-weight:800;
  color:#1e293b;
}
.dash-health-score{
  min-width:64px;
  text-align:center;
  border-radius:999px;
  padding:4px 9px;
  font-size:11px;
  font-weight:800;
  background:#eff6ff;
  color:#1d4ed8;
  border:1px solid #bfdbfe;
}
.dash-bars{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.dash-bar-row{
  display:grid;
  grid-template-columns:88px 1fr auto;
  gap:8px;
  align-items:center;
}
.dash-bar-label{
  font-size:11px;
  color:#475569;
  font-weight:700;
}
.dash-bar-track{
  height:8px;
  border-radius:999px;
  background:#e2e8f0;
  overflow:hidden;
}
.dash-bar-fill{
  display:block;
  height:100%;
  border-radius:inherit;
}
.dash-bar-fill.ok{background:linear-gradient(90deg,#34d399,#10b981)}
.dash-bar-fill.near{background:linear-gradient(90deg,#f59e0b,#f97316)}
.dash-bar-fill.past{background:linear-gradient(90deg,#fb7185,#ef4444)}
.dash-bar-fill.archive{background:linear-gradient(90deg,#60a5fa,#2563eb)}
.dash-bar-val{
  font-size:11px;
  color:#334155;
  font-weight:700;
}
.dash-analytics{
  display:grid;
  grid-template-columns:1.2fr 1fr;
  gap:14px;
  margin-top:14px;
}
.dash-chart-box{
  border:1px solid #e2e8f0;
  border-radius:12px;
  background:#fbfdff;
  padding:10px;
}
.dash-chart-title{
  margin:0 0 8px;
  font-size:12px;
  font-weight:800;
  color:#334155;
}
.dash-trend-chart{
  display:flex;
  gap:8px;
  align-items:flex-end;
  height:164px;
  padding:8px 6px 2px;
}
.dash-trend-col{
  flex:1;
  min-width:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-end;
  gap:6px;
}
.dash-trend-bars{
  width:100%;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  gap:4px;
  min-height:124px;
}
.dash-trend-bar{
  width:42%;
  border-radius:8px 8px 3px 3px;
  min-height:3px;
}
.dash-trend-bar.finalized{background:linear-gradient(180deg,#93c5fd 0%,#2563eb 100%)}
.dash-trend-bar.archived{background:linear-gradient(180deg,#c4b5fd 0%,#7c3aed 100%)}
.dash-trend-label{
  font-size:10px;
  color:#64748b;
  font-weight:700;
  text-align:center;
}
.dash-trend-legend{
  display:flex;
  gap:10px;
  font-size:11px;
  color:#475569;
  margin-top:6px;
}
.dash-trend-legend span{
  display:inline-flex;
  align-items:center;
  gap:5px;
}
.dash-trend-legend i{
  width:10px;
  height:10px;
  border-radius:999px;
  display:inline-block;
}
.dash-trend-legend .f{background:#2563eb}
.dash-trend-legend .a{background:#7c3aed}
.dash-kpi-head{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:10px;
}
.dash-kpi-ico{
  width:24px;
  height:24px;
  border-radius:8px;
  display:grid;
  place-items:center;
  background:#eff6ff;
  color:#1d4ed8;
}
.dash-kpi-ico svg{
  width:14px;
  height:14px;
  fill:currentColor;
}
.dash-kpi.warn .dash-kpi-ico{
  background:#fffbeb;
  color:#b45309;
}
.dash-kpi.danger .dash-kpi-ico{
  background:#fef2f2;
  color:#dc2626;
}
.dash-kpi.good .dash-kpi-ico{
  background:#f0fdf4;
  color:#15803d;
}
.dash-kpi-sub{
  margin-top:4px;
  font-size:10px;
  color:#64748b;
}
.dash-spark{
  margin-top:10px;
  height:44px;
  width:100%;
}
.dash-spark svg{
  width:100%;
  height:100%;
  display:block;
}
.dash-table-tight .detail-table th,
.dash-table-tight .detail-table td{
  padding:7px 8px;
}
.inspection-history-modal{padding:0}
.inspection-history-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:0;
}
.inspection-history-title{
  margin:0;
  font-size:18px;
  font-weight:800;
  color:#1f2937;
  letter-spacing:.2px;
}
.inspection-history-close{
  border:1px solid #cbd5e1;
  border-radius:999px;
  background:#f8fafc;
  color:#334155;
  font-size:12px;
  font-weight:700;
  padding:7px 14px;
  cursor:pointer;
}
.inspection-history-table-wrap{
  border:1px solid #e2e8f0;
  border-radius:8px;
  overflow:auto;
}
.inspection-history-table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
.inspection-history-table thead th{
  background:#e5e7eb;
  color:#334155;
  font-weight:700;
  padding:12px 10px;
  text-align:left;
  white-space:nowrap;
}
.inspection-history-table tbody td{
  border-bottom:1px solid #e5e7eb;
  padding:12px 10px;
  color:#1f2937;
  vertical-align:middle;
}
.inspection-history-table tbody tr:last-child td{border-bottom:none}
.insp-status-pill{
  display:inline-block;
  border-radius:6px;
  padding:3px 10px;
  font-size:12px;
  line-height:1.2;
  text-transform:lowercase;
}
.insp-status-pill.ok{background:#dcfce7;color:#166534}
.insp-status-pill.danger{background:#fee2e2;color:#b91c1c}
.inspection-history-empty{
  border:1px dashed #cbd5e1;
  border-radius:8px;
  padding:14px;
  text-align:center;
  color:#64748b;
}
.inspection-history-meta{color:#64748b}
.ics-link-btn{
  border:0;
  background:transparent;
  color:#1d4ed8;
  font-weight:700;
  padding:0;
  cursor:pointer;
}
.ics-link-btn:hover{text-decoration:underline}
.detail-grid{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:10px 14px;
  margin-bottom:12px;
}
.detail-item{
  border:1px solid #e2e8f0;
  border-radius:10px;
  background:#f8fafc;
  padding:8px 10px;
}
.detail-item .k{font-size:11px;color:#64748b;text-transform:uppercase}
.detail-item .v{font-size:13px;font-weight:600;color:#1f2937}
.detail-section-title{
  margin:10px 0 6px;
  font-size:13px;
  font-weight:700;
  color:#334155;
}
.detail-table-wrap{
  border:1px solid #e2e8f0;
  border-radius:10px;
  overflow:auto;
  max-height:240px;
}
.detail-table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}
.detail-table th,.detail-table td{
  padding:8px 10px;
  border-bottom:1px solid #eef2f7;
  text-align:left;
  white-space:nowrap;
}
.detail-table thead th{
  position:sticky;
  top:0;
  background:#f8fafc;
  color:#475569;
  z-index:1;
}
.detail-table tbody tr:last-child td{border-bottom:none}
.detail-focus{background:#eff6ff}
.ics-details-modal{
  width:min(1040px,95vw);
  max-height:90vh;
}
.ics-details-modal .modal-head{
  padding:11px 14px 10px;
}
.ics-details-modal .modal-head h3{
  font-size:16px;
}
.ics-details-modal .modal-body{
  padding:10px 14px 12px;
}
.ics-details-content{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.ics-details-content .detail-grid{
  gap:8px;
  margin-bottom:4px;
}
.ics-details-content .detail-item{
  padding:7px 9px;
}
.ics-details-content .detail-item .k{
  font-size:10px;
}
.ics-details-content .detail-item .v{
  font-size:12px;
  line-height:1.25;
}
.ics-details-content .detail-section-title{
  margin:6px 0 4px;
  font-size:12px;
}
.ics-details-content .profile-readonly{
  max-height:110px;
  overflow:auto;
  font-size:11px;
  line-height:1.35;
  margin-bottom:2px;
  padding:8px 9px;
}
.ics-details-content .detail-table-wrap{
  max-height:210px;
  border-radius:8px;
}
.ics-details-content .detail-table{
  font-size:11px;
}
.ics-details-content .detail-table th,
.ics-details-content .detail-table td{
  padding:6px 8px;
}
.ics-details-content .detail-table th:nth-child(2),
.ics-details-content .detail-table td:nth-child(2){
  white-space:normal;
  min-width:210px;
}
.wmr-section{
  border:1px solid #e2e8f0;
  border-radius:10px;
  background:#f8fafc;
  padding:10px;
  margin-top:8px;
}
.wmr-section-title{
  margin:0 0 8px;
  font-size:12px;
  font-weight:700;
  color:#334155;
}
.wmr-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px 10px;
}
.wmr-modal{
  width:min(1180px,96vw);
  max-height:min(90vh,900px);
  padding:0;
}
.wmr-modal .modal-head{
  margin-bottom:0;
  padding:14px 18px 12px;
}
.wmr-modal .modal-head h3{
  margin:0;
  font-size:30px;
  line-height:1.05;
  letter-spacing:.2px;
}
.wmr-modal .modal-head .modal-sub{
  margin-top:6px;
  font-size:14px;
}
.wmr-modal .modal-body{
  padding:10px 18px 14px;
}
.wmr-modal .modal-foot{
  padding:10px 18px 12px;
}
.wmr-modal .detail-grid{
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:8px;
  margin-bottom:8px;
}
.wmr-modal .detail-item{
  padding:7px 10px;
  border-radius:12px;
}
.wmr-modal .detail-item .k{
  font-size:10px;
  letter-spacing:.04em;
}
.wmr-modal .detail-item .v{
  margin-top:2px;
  font-size:17px;
  font-weight:800;
}
.wmr-modal .wmr-section{
  margin-top:6px;
  padding:8px 10px 10px;
}
.wmr-modal .wmr-section-title{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.05em;
  margin-bottom:6px;
}
.wmr-modal label{
  font-size:11px;
  color:#64748b;
  margin-bottom:4px;
}
.wmr-modal .stage-input{
  min-height:32px;
  padding:5px 9px;
  font-size:12px;
}
.wmr-modal textarea.stage-input{
  min-height:54px;
}
.wmr-modal .detail-table-wrap{
  max-height:230px !important;
}
.wmr-modal .detail-table{
  font-size:11px;
}
.wmr-modal .detail-table th,
.wmr-modal .detail-table td{
  padding:6px 7px;
}
.wmr-modal .detail-table td .stage-input{
  min-width:110px;
}
.wmr-modal .wmr-sale-note{
  margin-top:6px;
  font-size:10px;
}
.wmr-head-row{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
}
.wmr-head-close{
  border:1px solid #cbd5e1;
  border-radius:999px;
  background:#fff;
  color:#334155;
  font-size:12px;
  font-weight:700;
  padding:5px 12px;
  cursor:pointer;
}
@media (max-width: 760px){
  .archived-history-modal{
    width:min(100vw,100vw);
    max-height:100vh;
    border-radius:0;
  }
  .archived-history-modal .modal-head,
  .archived-history-modal .modal-body{
    padding-left:10px;
    padding-right:10px;
  }
  .archived-title-main{
    font-size:18px;
  }
  .archived-sheet-main{
    grid-template-columns:1fr;
  }
  .archived-sheet-side{
    border-right:none;
    border-bottom:1px solid #d6deef;
  }
  .archived-top-cards{
    grid-template-columns:1fr;
  }
  .archived-top-card{
    border-right:none;
    border-bottom:1px solid #e2e8f5;
  }
  .archived-top-card:last-child{
    border-bottom:none;
  }
  .archived-log-table{
    min-width:560px;
  }
  .archived-sheet-foot{
    flex-direction:column;
    align-items:flex-start;
  }
  .archived-export-btn{
    width:100%;
  }
  .ics-details-modal{
    width:min(98vw,740px);
  }
  .ics-details-content .detail-grid{
    grid-template-columns:1fr;
  }
  .ics-details-content .detail-table-wrap{
    max-height:190px;
  }
  .ics-details-content .detail-table th,
  .ics-details-content .detail-table td{
    padding:6px;
  }
  .wmr-grid{grid-template-columns:1fr}
  .wmr-modal{
    width:min(100vw,100vw);
    max-height:100vh;
    border-radius:0;
  }
  .wmr-modal .modal-head,
  .wmr-modal .modal-body,
  .wmr-modal .modal-foot{
    padding-left:10px;
    padding-right:10px;
  }
  .wmr-modal .detail-grid{
    grid-template-columns:repeat(2,minmax(0,1fr));
  }
  .wmr-modal .detail-table-wrap{
    max-height:none !important;
    overflow:visible;
    border:none;
    padding:0;
    background:transparent;
  }
  .wmr-modal .detail-table{
    display:block;
    width:100%;
    border-collapse:separate;
    border-spacing:0;
  }
  .wmr-modal .detail-table thead{
    display:none;
  }
  .wmr-modal .detail-table tbody{
    display:grid;
    gap:8px;
  }
  .wmr-modal .detail-table tbody tr{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:6px 8px;
    border:1px solid #dbe3ef;
    border-radius:12px;
    background:#fff;
    padding:8px;
  }
  .wmr-modal .detail-table tbody td{
    display:flex;
    flex-direction:column;
    gap:3px;
    white-space:normal;
    border-bottom:none;
    padding:0;
    min-width:0;
  }
  .wmr-modal .detail-table tbody td::before{
    content:attr(data-label);
    font-size:10px;
    color:#64748b;
    text-transform:uppercase;
    letter-spacing:.04em;
    font-weight:700;
  }
  .wmr-modal .detail-table tbody td .stage-input{
    width:100%;
    min-width:0;
  }
  .wmr-modal .detail-table tbody td[data-label="#"],
  .wmr-modal .detail-table tbody td[data-label="ICS No."],
  .wmr-modal .detail-table tbody td[data-label="Item No."]{
    grid-column:span 1;
  }
  .wmr-modal .detail-table tbody td[data-label="Description"]{
    grid-column:1 / -1;
  }
}
.wmr-sale-note{
  font-size:11px;
  color:#64748b;
  margin-top:4px;
}
.arch-history-grid{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:10px 12px;
  margin:0;
}
.arch-history-meta{
  border:1px solid #e2e8f0;
  border-radius:8px;
  background:#f8fafc;
  padding:8px 9px;
}
.arch-history-meta .k{font-size:11px;color:#64748b;text-transform:uppercase}
.arch-history-meta .v{font-size:13px;font-weight:600;color:#1f2937}
.archived-history-modal{
  width:min(1060px,96vw);
  max-height:90vh;
  padding:0;
}
.archived-history-modal .modal-head{
  padding:10px 14px;
  background:linear-gradient(180deg,#0b1a3a 0%,#0a1733 100%);
  border-bottom:1px solid #1e325f;
}
.archived-history-modal .modal-head h3{
  margin:0;
  color:#f8fbff;
  display:flex;
  align-items:center;
  gap:10px;
  font-size:25px;
}
.archived-title-main{
  font-size:19px;
  font-weight:800;
  color:#f8fbff;
}
.archived-title-badge{
  display:inline-flex;
  align-items:center;
  border-radius:6px;
  padding:3px 7px;
  font-size:10px;
  letter-spacing:.2px;
  font-weight:800;
}
.archived-title-badge.approved{
  background:#0e513d;
  border:1px solid #1bb57f;
  color:#b9ffe8;
}
.archived-title-badge.pending{
  background:#5a3b12;
  border:1px solid #c48f2a;
  color:#fff0cc;
}
.archived-history-close{
  border:0;
  background:transparent;
  color:#afbddf;
  font-size:20px;
  line-height:1;
  cursor:pointer;
  padding:2px 6px;
}
.archived-history-close:hover{
  color:#ffffff;
}
.archived-history-modal .modal-body{
  padding:0;
  background:#f2f5fb;
}
.archived-sheet{
  display:flex;
  flex-direction:column;
  min-height:0;
}
.archived-sheet-main{
  display:grid;
  grid-template-columns:250px 1fr;
  min-height:0;
}
.archived-sheet-side{
  border-right:1px solid #d6deef;
  background:#eef2f9;
  padding:10px 12px;
  overflow:auto;
}
.archived-side-section-title{
  margin:2px 0 6px;
  font-size:11px;
  font-weight:800;
  letter-spacing:.2px;
  text-transform:uppercase;
  color:#7587a9;
}
.archived-side-row{
  padding:6px 0;
  border-bottom:1px solid #dce4f3;
}
.archived-side-row .k{
  font-size:9px;
  text-transform:uppercase;
  color:#7a8daf;
  font-weight:800;
  margin-bottom:2px;
}
.archived-side-row .v{
  font-size:12px;
  color:#152b52;
  font-weight:700;
}
.archived-sheet-right{
  padding:10px 12px;
  display:flex;
  flex-direction:column;
  gap:8px;
  background:#f7f9fd;
  overflow:auto;
}
.archived-top-cards{
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  border:1px solid #d9e0ee;
  border-radius:8px;
  overflow:hidden;
  background:#ffffff;
}
.archived-top-card{
  padding:9px 10px;
  border-right:1px solid #e2e8f5;
}
.archived-top-card:last-child{border-right:none}
.archived-top-card .k{
  font-size:10px;
  text-transform:uppercase;
  color:#7b8fb3;
  font-weight:800;
}
.archived-top-card .v{
  margin-top:4px;
  font-size:16px;
  font-weight:700;
  color:#0f2a55;
}
.archived-remarks{
  font-style:italic;
  color:#3a537d;
}
.archived-logs-card{
  border:1px solid #d8dfed;
  border-radius:8px;
  background:#fff;
  padding:8px 8px 6px;
  box-shadow:0 6px 16px rgba(15,23,42,.06);
}
.archived-logs-title{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.2px;
  color:#6f83a8;
  font-weight:800;
  margin-bottom:6px;
}
.archived-logs-wrap{
  overflow:auto;
  border:1px solid #dde5f3;
  border-radius:6px;
}
.archived-log-table{
  width:100%;
  border-collapse:collapse;
  min-width:560px;
  font-size:11px;
}
.archived-log-table thead th{
  background:#eef2f9;
  color:#5f739a;
  font-size:10px;
  text-transform:uppercase;
  letter-spacing:.2px;
  text-align:left;
  padding:8px 10px;
  border-bottom:1px solid #dce4f3;
}
.archived-log-table tbody td{
  padding:8px 10px;
  border-bottom:1px solid #e6edf8;
  color:#1d3763;
}
.archived-log-table tbody tr:last-child td{border-bottom:none}
.archive-log-pill{
  display:inline-flex;
  align-items:center;
  border-radius:8px;
  padding:3px 8px;
  font-size:10px;
  font-weight:800;
  letter-spacing:.2px;
}
.archive-log-pill.unserviceable{
  background:#ffe4ea;
  color:#c50f3c;
}
.archive-log-pill.serviceable{
  background:#d9f6e4;
  color:#087443;
}
.archived-sheet-foot{
  border-top:1px solid #d9e0ef;
  background:#eef2f8;
  padding:9px 12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}
.archived-foot-meta{
  font-size:10px;
  color:#7084a8;
  font-weight:700;
}
.archived-foot-ref{
  margin-left:14px;
  color:#8094b8;
}
.archived-export-btn{
  border:0;
  border-radius:7px;
  padding:7px 11px;
  font-size:11px;
  font-weight:800;
  color:#ffffff;
  background:linear-gradient(135deg,#4f46e5 0%,#4338ca 100%);
  cursor:pointer;
}
.archived-export-btn:hover{
  filter:brightness(1.05);
}
.notif-wrap{position:relative}
.notif-badge{
  position:absolute;
  top:-4px;
  right:-4px;
  min-width:16px;
  height:16px;
  border-radius:999px;
  background:#ef4444;
  color:#fff;
  font-size:10px;
  font-weight:700;
  display:none;
  place-items:center;
  padding:0 4px;
}
.notif-panel{
  position:absolute;
  top:44px;
  right:0;
  width:320px;
  max-height:360px;
  overflow:auto;
  background:#fff;
  border:1px solid #e2e8f0;
  border-radius:12px;
  box-shadow:0 20px 35px rgba(15,23,42,.15);
  display:none;
  z-index:150;
}
.notif-panel.show{display:block}
.notif-head{
  padding:10px 12px;
  border-bottom:1px solid #f1f5f9;
  font-size:12px;
  font-weight:700;
}
.notif-empty{
  padding:14px 12px;
  font-size:12px;
  color:var(--tm);
}
.notif-item{
  padding:10px 12px;
  border-bottom:1px solid #f8fafc;
  font-size:12px;
  line-height:1.4;
}
.notif-item:last-child{border-bottom:0}
.notif-item.success{background:#f0fdf4}
.notif-item.error{background:#fef2f2}
.notif-item.info{background:#eff6ff}
.notif-meta{
  margin-top:4px;
  color:var(--tm);
  font-size:10px;
}



/* MAIN */
.main{
  margin-top:0;
  flex:1;
  padding:6px 6px 24px;
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* ICS STAGED ITEMS CARD */
.ics-card{
  background:#fff;
  border-radius:var(--r1);
  box-shadow:var(--sh);
  padding:16px;
  margin-top:0;
  transition:box-shadow .2s ease, transform .2s ease, border-color .2s ease;
}
.ics-card:hover{
  box-shadow:0 14px 30px rgba(15,23,42,.1);
}
.ics-card-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
  font-weight:700;
  padding-bottom:8px;
  border-bottom:1px solid #edf2f7;
}
.ics-card.staged{
  background:linear-gradient(180deg,#f8fbff 0%, #ffffff 65%);
  border:1px solid #dbeafe;
}
.ics-card.records{
  background:#ffffff;
  border:1px solid #e2e8f0;
}
.card-title{display:flex;align-items:center;gap:8px}
.card-badge{
  font-size:10px;
  font-weight:700;
  border-radius:999px;
  padding:3px 8px;
  letter-spacing:.02em;
}
.card-badge.staged{
  background:#eff6ff;
  color:#1d4ed8;
  border:1px solid #bfdbfe;
}
.card-badge.records{
  background:#f1f5f9;
  color:#334155;
  border:1px solid #cbd5e1;
}
.card-subtext{
  margin:0 0 10px;
  font-size:12px;
  color:var(--tm);
}
.stage-context{
  font-size:11px;
  color:var(--tm);
  font-weight:600;
}
.ics-table{width:100%;border-collapse:collapse;font-size:12px}
.ics-table th{color:var(--tm);text-align:left;font-size:11px;padding:8px 6px;border-bottom:1px solid #eef2f7}
.ics-table td{padding:6px;border-bottom:1px solid #f1f5f9}
.ics-table td[contenteditable]{background:#f8fafc;border-radius:6px}
.stage-input{
  width:100%;
  border:1px solid #cbd5e1;
  border-radius:6px;
  padding:4px 6px;
  font-size:12px;
  background:#fff;
}
.stage-input[readonly]{background:#f8fafc}
.stage-input.dup-error{
  border-color:#dc2626;
  box-shadow:0 0 0 2px rgba(220,38,38,.12);
  background:#fef2f2;
}
.stage-cell-actions{display:flex;gap:6px;justify-content:center}
.stage-eul{display:flex;gap:4px;align-items:center}
.eul-input{text-align:center}
.eul-btn{
  border:1px solid #cbd5e1;
  border-radius:6px;
  background:#fff;
  width:22px;
  height:22px;
  line-height:20px;
  cursor:pointer;
}
.records .ics-table th{background:#f8fafc}
.records .ics-table td{font-size:11px}
.records .ics-table tbody tr:nth-child(even){background:#fcfdff}
.records .ics-table tbody tr:hover{background:#f7fbff}
.records .ics-table{
  table-layout:fixed;
  width:100%;
}
.records-table-wrap .ics-table th:first-child,
.records-table-wrap .ics-table td:first-child,
.stage-table-wrap .ics-table th:first-child,
.stage-table-wrap .ics-table td:first-child{
  position:sticky;
  left:0;
}
.records-table-wrap .ics-table thead th:first-child{
  z-index:4;
  background:#f8fafc;
}
.records-table-wrap .ics-table tbody td:first-child{
  z-index:1;
  background:#fff;
}
.stage-table-wrap .ics-table thead th:first-child{
  z-index:4;
  background:#eef6ff;
}
.stage-table-wrap .ics-table tbody td:first-child{
  z-index:1;
  background:#fff;
}
.records .ics-table tbody tr:nth-child(even) td:first-child{background:#fcfdff}
.records .ics-table tbody tr:hover td:first-child{background:#f7fbff}
.records .ics-table td:nth-child(5){
  word-break:break-word;
}
.records .ics-records-table td:nth-child(3){
  white-space:normal;
  overflow-wrap:anywhere;
  word-break:break-word;
  line-height:1.35;
}
.records .ics-records-table td:last-child{
  white-space:nowrap;
}
.records .actions-eul-table td:last-child{
  white-space:normal;
}
.records .actions-eul-table td:nth-child(3){
  word-break:break-word;
  white-space:normal;
}
.records .actions-eul-table td:nth-child(8){
  white-space:normal;
}
.records .actions-eul-table .stage-input{
  max-width:78px;
}
.records .actions-eul-table tbody tr.targeted-row{
  background:#eff6ff;
  box-shadow:inset 3px 0 0 #2563eb;
}
.records .actions-eul-table tbody tr.targeted-row td:first-child{background:#eff6ff}
.actions-eul-actions{
  display:flex;
  flex-wrap:wrap;
  gap:4px;
  justify-content:center;
  align-items:center;
}
.actions-eul-actions .small-btn{
  padding:4px 9px;
  font-size:11px;
}
.action-icon-btn{
  display:inline-flex;
  align-items:center;
  gap:4px;
}
.action-icon-btn svg{
  width:12px;
  height:12px;
  fill:currentColor;
}
.action-select{
  width:72px;
  display:inline-block;
}
.actions-eul-wrap{
  overflow:visible;
  max-height:none;
}
.records .ics-table thead th:last-child{
  text-align:center;
}
.records-table-wrap{
  max-height:340px;
  overflow:auto;
  border:1px solid #e2e8f0;
  border-radius:12px;
}
.table-density-toggle{
  display:inline-flex;
  align-items:center;
  gap:4px;
  padding:3px;
  border:1px solid #cbd5e1;
  border-radius:999px;
  background:#fff;
}
.density-btn{
  border:0;
  border-radius:999px;
  padding:4px 9px;
  font-size:11px;
  font-weight:700;
  color:#475569;
  background:transparent;
  cursor:pointer;
}
.density-btn.active{
  background:#eff6ff;
  color:#1d4ed8;
}
.records .ics-table thead th{
  position:sticky;
  top:0;
  z-index:2;
  background:#f8fafc;
  box-shadow:0 1px 0 #e2e8f0;
}
.records .ics-table col.c-idx{width:2%}
.records .ics-table col.c-ics{width:12%}
.records .ics-table col.c-entity{width:24%}
.records .ics-table col.c-issued{width:7%}
.records .ics-table col.c-accountable{width:13%}
.records .ics-table col.c-eul{width:11%}
.records .ics-table col.c-items{width:6%}
.records .ics-table col.c-total{width:10%}
.records .ics-table col.c-actions{width:15%}
.records .ics-no-line .ics-link-btn{
  display:inline-block;
  max-width:100%;
  min-width:0;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.risk-badge{
  display:inline-block;
  border-radius:999px;
  padding:2px 7px;
  font-size:10px;
  font-weight:700;
  margin-right:4px;
}
.risk-badge.warn{background:#fef3c7;color:#92400e}
.risk-badge.near{background:#dbeafe;color:#1e40af}
.risk-badge.danger{background:#fee2e2;color:#991b1b}
.risk-badge.ok{background:#dcfce7;color:#166534}
.value-main{font-weight:700}
.value-sub{
  margin-top:2px;
  font-size:10px;
  color:var(--tm);
}
.empty-cell{
  text-align:center;
  color:var(--tm);
  padding:16px 8px;
  font-style:italic;
}
.stage-table-wrap{
  max-height:340px;
  overflow:auto;
  border:1px solid #e2e8f0;
  border-radius:12px;
}
.records-table-wrap,
.stage-table-wrap,
.detail-table-wrap,
.inspection-history-table-wrap{
  -ms-overflow-style:none;
  scrollbar-width:none;
}
.records-table-wrap::-webkit-scrollbar,
.stage-table-wrap::-webkit-scrollbar,
.detail-table-wrap::-webkit-scrollbar,
.inspection-history-table-wrap::-webkit-scrollbar{
  width:0;
  height:0;
}
.staged .ics-table thead th{
  position:sticky;
  top:0;
  z-index:2;
  background:#eef6ff;
  box-shadow:0 1px 0 #dbeafe;
}
.ics-card-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}
.small-btn{border:0;border-radius:999px;padding:6px 12px;font-size:12px;font-weight:600;cursor:pointer}
.small-btn.add{background:var(--btn-add-bg);color:var(--btn-add-text)}
.small-btn.finalize{background:var(--btn-primary-bg);color:var(--btn-primary-text)}
.small-btn.del{background:var(--btn-del-bg);color:var(--btn-del-text)}
.small-btn:disabled{opacity:.55;cursor:not-allowed;filter:grayscale(.2)}
.small-btn:not(:disabled){transition:transform .16s ease, box-shadow .2s ease}
.small-btn:not(:disabled):hover{transform:translateY(-1px);box-shadow:0 8px 16px rgba(15,23,42,.12)}
.icon-only-btn{
  width:30px;
  height:30px;
  padding:0;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:9px;
}
.icon-only-btn svg{
  width:15px;
  height:15px;
  fill:currentColor;
}

body[data-density="compact"] .ics-table th{padding:6px 5px;font-size:10px}
body[data-density="compact"] .ics-table td{padding:4px 5px;font-size:10px}
body[data-density="compact"] .small-btn{padding:4px 9px;font-size:11px}
body[data-density="compact"] .stage-input{padding:3px 5px;font-size:11px}
.modal-form{
  display:grid;
  gap:10px;
}
.modal-form label{
  font-size:11px;
  color:var(--tm);
}
.modal-form .stage-input{
  border-color:#c7d3e2;
}
.stage-input.field-error{
  border-color:#dc2626 !important;
  background:#fff5f5;
  box-shadow:0 0 0 2px rgba(220,38,38,.12);
}
.profile-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px 12px;
}
.profile-grid .full{grid-column:1 / -1}
.profile-shell{
  display:grid;
  grid-template-columns:220px minmax(0,1fr);
  gap:12px;
}
.profile-side{
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  background:var(--surface-soft);
  display:flex;
  flex-direction:column;
  gap:10px;
}
.profile-side-title{
  margin:0;
  font-size:11px;
  letter-spacing:.08em;
  text-transform:uppercase;
  color:var(--tm);
  font-weight:800;
}
.profile-side-menu{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.profile-menu-btn{
  border:1px solid var(--border);
  background:#fff;
  color:var(--t);
  border-radius:10px;
  padding:8px 10px;
  text-align:left;
  font-size:12px;
  font-weight:700;
  cursor:pointer;
}
.profile-menu-btn.active{
  border-color:var(--a);
  background:var(--surface-soft);
  box-shadow:0 0 0 1px var(--a);
}
.profile-menu-btn:focus-visible{
  outline:2px solid var(--a);
  outline-offset:1px;
}
.profile-side-meta{
  margin-top:auto;
  border-top:1px dashed var(--border);
  padding-top:8px;
  display:grid;
  gap:6px;
}
.profile-side-meta .k{
  font-size:10px;
  text-transform:uppercase;
  letter-spacing:.08em;
  color:var(--tm);
  font-weight:800;
}
.profile-side-meta .v{
  font-size:12px;
  color:var(--t);
  font-weight:700;
}
.profile-content{
  min-width:0;
}
.profile-pane{
  display:none;
}
.profile-pane.active{
  display:block;
}
.profile-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}
.profile-head-meta{
  display:flex;
  flex-direction:column;
  gap:3px;
}
.profile-head-title{
  margin:0;
  font-size:14px;
  font-weight:800;
  color:var(--t);
}
.profile-head-sub{
  margin:0;
  font-size:11px;
  color:var(--tm);
}
.profile-section{
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px;
  background:var(--surface-soft);
}
.profile-section-title{
  margin:0 0 8px;
  font-size:11px;
  letter-spacing:.08em;
  text-transform:uppercase;
  color:var(--tm);
  font-weight:800;
}
.profile-avatar-preview{
  width:34px;
  height:34px;
  border-radius:999px;
  border:1px solid #bfdbfe;
  background:#eff6ff;
  color:#1d4ed8;
  display:grid;
  place-items:center;
  font-size:13px;
  font-weight:800;
}
.profile-avatar-preview.has-icon,
.sidebar-profile-avatar.has-icon{
  font-size:0;
}
.profile-avatar-icon{
  width:16px;
  height:16px;
  display:block;
  fill:currentColor;
}
.avatar-picker{
  display:grid;
  grid-template-columns:repeat(6,minmax(0,1fr));
  gap:6px;
}
.avatar-picker-btn{
  border:1px solid var(--border);
  background:#fff;
  color:var(--t);
  border-radius:9px;
  height:32px;
  display:grid;
  place-items:center;
  cursor:pointer;
}
.avatar-picker-btn svg{
  width:14px;
  height:14px;
  fill:currentColor;
}
.avatar-picker-btn.active{
  border-color:var(--a);
  box-shadow:0 0 0 1px var(--a);
}
.avatar-picker-btn:focus-visible{
  outline:2px solid var(--a);
  outline-offset:1px;
}
.profile-readonly{
  border:1px solid var(--border);
  border-radius:10px;
  padding:9px 10px;
  background:#fff;
  font-size:12px;
  color:var(--t);
  font-weight:600;
  word-break:break-word;
}
.theme-preview-grid{
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  gap:8px;
}
.theme-preview-btn{
  border:1px solid var(--border);
  border-radius:8px;
  background:#fff;
  color:var(--t);
  padding:6px 8px;
  font-size:11px;
  font-weight:700;
  cursor:pointer;
  text-align:left;
  display:flex;
  flex-direction:column;
  gap:5px;
}
.theme-preview-btn .theme-name{
  line-height:1.1;
}
.theme-preview-btn .theme-swatches{
  display:flex;
  gap:4px;
}
.theme-preview-btn .theme-swatches i{
  display:block;
  width:14px;
  height:6px;
  border-radius:999px;
}
.theme-preview-btn[data-theme="playful"] .theme-swatches i:nth-child(1){background:#f97316}
.theme-preview-btn[data-theme="playful"] .theme-swatches i:nth-child(2){background:#fff2e8}
.theme-preview-btn[data-theme="playful"] .theme-swatches i:nth-child(3){background:#c2410c}
.theme-preview-btn[data-theme="elegant-white"] .theme-swatches i:nth-child(1){background:#2563eb}
.theme-preview-btn[data-theme="elegant-white"] .theme-swatches i:nth-child(2){background:#eff6ff}
.theme-preview-btn[data-theme="elegant-white"] .theme-swatches i:nth-child(3){background:#1d4ed8}
.theme-preview-btn[data-theme="elegant-green"] .theme-swatches i:nth-child(1){background:#121a1b}
.theme-preview-btn[data-theme="elegant-green"] .theme-swatches i:nth-child(2){background:#a7aa63}
.theme-preview-btn[data-theme="elegant-green"] .theme-swatches i:nth-child(3){background:#eae6d2}
.theme-preview-btn[data-theme="velvet-red"] .theme-swatches i:nth-child(1){background:#b91c1c}
.theme-preview-btn[data-theme="velvet-red"] .theme-swatches i:nth-child(2){background:#fff1f2}
.theme-preview-btn[data-theme="velvet-red"] .theme-swatches i:nth-child(3){background:#991b1b}
.theme-preview-btn[data-theme="crimson-black"] .theme-swatches i:nth-child(1){background:#be123c}
.theme-preview-btn[data-theme="crimson-black"] .theme-swatches i:nth-child(2){background:#2a131d}
.theme-preview-btn[data-theme="crimson-black"] .theme-swatches i:nth-child(3){background:#fb7185}
.theme-preview-btn[data-theme="nord"] .theme-swatches i:nth-child(1){background:#90c2e7}
.theme-preview-btn[data-theme="nord"] .theme-swatches i:nth-child(2){background:#fef7f8}
.theme-preview-btn[data-theme="nord"] .theme-swatches i:nth-child(3){background:#22819a}
.theme-preview-btn[data-theme="dracula"] .theme-swatches i:nth-child(1){background:#6f2dbd}
.theme-preview-btn[data-theme="dracula"] .theme-swatches i:nth-child(2){background:#a663cc}
.theme-preview-btn[data-theme="dracula"] .theme-swatches i:nth-child(3){background:#171123}
.theme-preview-btn:focus-visible{
  outline:2px solid var(--a);
  outline-offset:1px;
}
.theme-preview-btn.active{
  border-color:var(--a);
  outline:2px solid var(--a);
  outline-offset:1px;
}

/* Dark theme surface consistency fix */
body[data-theme="dracula"] .profile-section,
body[data-theme="crimson-black"] .profile-section{
  background:rgba(255,255,255,.04);
  border-color:currentColor;
}
body[data-theme="dracula"] .profile-side,
body[data-theme="crimson-black"] .profile-side{
  background:rgba(255,255,255,.04);
  border-color:currentColor;
}
body[data-theme="dracula"] .profile-menu-btn,
body[data-theme="crimson-black"] .profile-menu-btn,
body[data-theme="dracula"] .profile-readonly,
body[data-theme="crimson-black"] .profile-readonly{
  background:rgba(255,255,255,.05);
  border-color:currentColor;
  color:#f8fafc;
}
body[data-theme="dracula"] .avatar-picker-btn,
body[data-theme="crimson-black"] .avatar-picker-btn{
  background:rgba(255,255,255,.05);
  border-color:currentColor;
  color:#f8fafc;
}
@media (max-width: 900px){
  .profile-shell{
    grid-template-columns:1fr;
  }
  .profile-side{
    padding:8px;
  }
  .profile-side-menu{
    display:grid;
    grid-template-columns:repeat(2,minmax(0,1fr));
  }
}
@media (max-width: 640px){
  .profile-side-menu{
    grid-template-columns:1fr;
  }
}
body[data-theme="dracula"] .sidebar-profile,
body[data-theme="crimson-black"] .sidebar-profile{
  background:rgba(255,255,255,.04);
  border-color:rgba(255,255,255,.24);
}
body[data-theme="dracula"] .profile-avatar-preview,
body[data-theme="crimson-black"] .profile-avatar-preview{
  background:rgba(255,255,255,.08);
  border-color:rgba(255,255,255,.2);
  color:#fbfbfb;
}
body[data-theme="dracula"] .sidebar-profile-name,
body[data-theme="crimson-black"] .sidebar-profile-name{color:#f8fafc}
body[data-theme="dracula"] .sidebar-profile-avatar,
body[data-theme="crimson-black"] .sidebar-profile-avatar{
  border:1px solid rgba(255,255,255,.18);
}
body[data-theme="dracula"] .theme-preview-btn,
body[data-theme="crimson-black"] .theme-preview-btn{
  background:rgba(255,255,255,.03);
  border-color:rgba(255,255,255,.25);
  color:#f8fafc;
}
body[data-theme="dracula"] .table-density-toggle,
body[data-theme="crimson-black"] .table-density-toggle{
  background:rgba(255,255,255,.04);
  border-color:rgba(255,255,255,.2);
}
body[data-theme="dracula"] .density-btn,
body[data-theme="crimson-black"] .density-btn{
  color:#cbd5e1;
}
body[data-theme="dracula"] .density-btn.active,
body[data-theme="crimson-black"] .density-btn.active{
  background:rgba(255,255,255,.16);
  color:#ffffff;
}
body[data-theme="dracula"] .records .ics-table thead th,
body[data-theme="dracula"] .records-table-wrap .ics-table thead th:first-child,
body[data-theme="dracula"] .stage-table-wrap .ics-table thead th:first-child{
  background:#241f3b;
  color:#d8def0;
}
body[data-theme="crimson-black"] .records .ics-table thead th,
body[data-theme="crimson-black"] .records-table-wrap .ics-table thead th:first-child,
body[data-theme="crimson-black"] .stage-table-wrap .ics-table thead th:first-child{
  background:#1f1722;
  color:#cbd5e1;
}
body[data-theme="dracula"] .records-table-wrap .ics-table tbody td:first-child,
body[data-theme="dracula"] .stage-table-wrap .ics-table tbody td:first-child{
  background:#1c1730;
  color:#d8def0;
}
body[data-theme="crimson-black"] .records-table-wrap .ics-table tbody td:first-child,
body[data-theme="crimson-black"] .stage-table-wrap .ics-table tbody td:first-child{
  background:#17111a;
  color:#cbd5e1;
}
body[data-theme="dracula"] .records .ics-table tbody tr:nth-child(even) td:first-child{background:#1f1934}
body[data-theme="dracula"] .records .ics-table tbody tr:hover td:first-child{background:#2a2142}
body[data-theme="crimson-black"] .records .ics-table tbody tr:nth-child(even) td:first-child{background:#18121d}
body[data-theme="crimson-black"] .records .ics-table tbody tr:hover td:first-child{background:#231826}
body[data-theme="dracula"] .records .actions-eul-table tbody tr.targeted-row,
body[data-theme="dracula"] .records .actions-eul-table tbody tr.targeted-row td:first-child{
  background:#2f254b;
  box-shadow:inset 3px 0 0 #a663cc;
}
body[data-theme="crimson-black"] .records .actions-eul-table tbody tr.targeted-row,
body[data-theme="crimson-black"] .records .actions-eul-table tbody tr.targeted-row td:first-child{
  background:#2a1a24;
  box-shadow:inset 3px 0 0 #fb7185;
}
body[data-theme="dracula"] .ics-card.staged{
  background:linear-gradient(180deg,#25193a 0%, #1d1630 65%);
  border-color:#5e3c76;
}
body[data-theme="crimson-black"] .ics-card.staged{
  background:linear-gradient(180deg,#241620 0%, #1a1218 65%);
  border-color:#4b2a33;
}
body[data-theme="dracula"] .card-badge.staged{
  background:#2f2448;
  color:#f3e8ff;
  border-color:#a663cc;
}
body[data-theme="crimson-black"] .card-badge.staged{
  background:#341d28;
  color:#ffe4ea;
  border-color:#fb7185;
}
body[data-theme="dracula"] .staged .ics-table thead th,
body[data-theme="dracula"] .stage-table-wrap .ics-table thead th:first-child{
  background:#2a1f43;
  color:#d8def0;
  box-shadow:0 1px 0 #5e3c76;
}
body[data-theme="crimson-black"] .staged .ics-table thead th,
body[data-theme="crimson-black"] .stage-table-wrap .ics-table thead th:first-child{
  background:#2a1a24;
  color:#cbd5e1;
  box-shadow:0 1px 0 #4b2a33;
}
body[data-theme="dracula"] .stage-input[readonly]{background:rgba(0,0,0,.32)}
body[data-theme="crimson-black"] .stage-input[readonly]{background:rgba(0,0,0,.34)}
body[data-theme="dracula"] .eul-btn{
  background:#2d1d42;
  border-color:#5e3c76;
  color:#fbfbfb;
}
body[data-theme="crimson-black"] .eul-btn{
  background:#2a1a24;
  border-color:#4b2a33;
  color:#fff1f2;
}
body[data-theme="dracula"] .notif-panel{
  background:#1c1730;
  border-color:#5e3c76;
}
body[data-theme="crimson-black"] .notif-panel{
  background:#17111a;
  border-color:#4b2a33;
}
body[data-theme="dracula"] .notif-head,
body[data-theme="crimson-black"] .notif-head{
  color:#fbfbfb;
  border-bottom-color:rgba(255,255,255,.14);
}
body[data-theme="dracula"] .notif-empty,
body[data-theme="crimson-black"] .notif-empty{
  color:#cbd5e1;
}
body[data-theme="dracula"] .notif-item,
body[data-theme="crimson-black"] .notif-item{
  color:#e2e8f0;
  border-bottom-color:rgba(255,255,255,.08);
}
body[data-theme="dracula"] .notif-item.success{background:#243034}
body[data-theme="dracula"] .notif-item.error{background:#3a2231}
body[data-theme="dracula"] .notif-item.info{background:#222f45}
body[data-theme="crimson-black"] .notif-item.success{background:#23312b}
body[data-theme="crimson-black"] .notif-item.error{background:#3a232a}
body[data-theme="crimson-black"] .notif-item.info{background:#232a3a}
body[data-theme="dracula"] .dash-chip{
  background:#2a1f3b;
  border-color:#5e3c76;
  color:#f3e8ff;
}
body[data-theme="dracula"] .dash-chip:hover{
  background:#3b2a55;
  border-color:#a663cc;
}
body[data-theme="crimson-black"] .dash-chip{
  background:#2a1a24;
  border-color:#4b2a33;
  color:#ffe4ea;
}
body[data-theme="crimson-black"] .dash-chip:hover{
  background:#3a2231;
  border-color:#fb7185;
}

/* Dark theme modal contrast pass: WMR + Inspection History */
body[data-theme="dracula"] .inspection-history-title,
body[data-theme="crimson-black"] .inspection-history-title{
  color:#f8fafc;
}
body[data-theme="dracula"] .inspection-history-close,
body[data-theme="crimson-black"] .inspection-history-close{
  background:rgba(255,255,255,.08);
  border-color:rgba(255,255,255,.2);
  color:#f8fafc;
}
body[data-theme="dracula"] .inspection-history-table-wrap{
  border-color:#4b3f6d;
}
body[data-theme="crimson-black"] .inspection-history-table-wrap{
  border-color:#4b2a33;
}
body[data-theme="dracula"] .inspection-history-table thead th{
  background:#2a2142;
  color:#e8edff;
}
body[data-theme="crimson-black"] .inspection-history-table thead th{
  background:#2a1a24;
  color:#fde8ef;
}
body[data-theme="dracula"] .inspection-history-table tbody td,
body[data-theme="crimson-black"] .inspection-history-table tbody td{
  color:#e2e8f0;
  border-bottom-color:rgba(255,255,255,.1);
}
body[data-theme="dracula"] .inspection-history-meta,
body[data-theme="crimson-black"] .inspection-history-meta{
  color:#a7b4cc;
}
body[data-theme="dracula"] .inspection-history-empty,
body[data-theme="crimson-black"] .inspection-history-empty{
  border-color:rgba(255,255,255,.22);
  color:#cbd5e1;
}
body[data-theme="dracula"] .wmr-modal .modal-head{
  border-bottom:1px solid #5e3c76;
}
body[data-theme="crimson-black"] .wmr-modal .modal-head{
  border-bottom:1px solid #4b2a33;
}
body[data-theme="dracula"] .wmr-head-close,
body[data-theme="crimson-black"] .wmr-head-close{
  background:rgba(255,255,255,.08);
  border-color:rgba(255,255,255,.22);
  color:#f8fafc;
}
body[data-theme="dracula"] .wmr-modal .detail-item,
body[data-theme="crimson-black"] .wmr-modal .detail-item{
  background:rgba(255,255,255,.06);
  border-color:rgba(255,255,255,.2);
}
body[data-theme="dracula"] .wmr-modal .detail-item .k,
body[data-theme="crimson-black"] .wmr-modal .detail-item .k{
  color:#b7c2d8;
}
body[data-theme="dracula"] .wmr-modal .detail-item .v,
body[data-theme="crimson-black"] .wmr-modal .detail-item .v{
  color:#f8fafc;
}
body[data-theme="dracula"] .wmr-modal .wmr-section,
body[data-theme="crimson-black"] .wmr-modal .wmr-section{
  background:rgba(255,255,255,.05);
  border-color:rgba(255,255,255,.2);
}
body[data-theme="dracula"] .wmr-modal .wmr-section-title,
body[data-theme="crimson-black"] .wmr-modal .wmr-section-title{
  color:#dbe7ff;
}
body[data-theme="dracula"] .wmr-modal label,
body[data-theme="crimson-black"] .wmr-modal label{
  color:#b7c2d8;
}
body[data-theme="dracula"] .wmr-modal .stage-input,
body[data-theme="crimson-black"] .wmr-modal .stage-input{
  background:rgba(8,10,18,.72);
  border-color:rgba(255,255,255,.2);
  color:#f8fafc;
}
body[data-theme="dracula"] .wmr-modal .stage-input::placeholder,
body[data-theme="crimson-black"] .wmr-modal .stage-input::placeholder{
  color:#94a3b8;
}
body[data-theme="dracula"] .wmr-modal .detail-table-wrap,
body[data-theme="crimson-black"] .wmr-modal .detail-table-wrap{
  border-color:rgba(255,255,255,.2);
}
body[data-theme="dracula"] .wmr-modal .detail-table thead th{
  background:#2a2142;
  color:#e8edff;
}
body[data-theme="crimson-black"] .wmr-modal .detail-table thead th{
  background:#2a1a24;
  color:#fde8ef;
}
body[data-theme="dracula"] .wmr-modal .detail-table tbody td,
body[data-theme="crimson-black"] .wmr-modal .detail-table tbody td{
  color:#e2e8f0;
  border-bottom-color:rgba(255,255,255,.08);
}
body[data-theme="dracula"] .wmr-modal .wmr-sale-note,
body[data-theme="crimson-black"] .wmr-modal .wmr-sale-note{
  color:#b7c2d8;
}
@media (max-width:760px){
  body[data-theme="dracula"] .wmr-modal .detail-table tbody tr,
  body[data-theme="crimson-black"] .wmr-modal .detail-table tbody tr{
    background:rgba(255,255,255,.06);
    border-color:rgba(255,255,255,.24);
  }
}

/* Dark theme accent differentiation */
body[data-theme="dracula"] .inspection-history-close:hover,
body[data-theme="dracula"] .wmr-head-close:hover{
  border-color:#a78bfa;
  box-shadow:0 0 0 1px rgba(167,139,250,.35);
}
body[data-theme="crimson-black"] .inspection-history-close:hover,
body[data-theme="crimson-black"] .wmr-head-close:hover{
  border-color:#fb7185;
  box-shadow:0 0 0 1px rgba(251,113,133,.35);
}
body[data-theme="dracula"] .inspection-history-table thead th{
  box-shadow:inset 0 -1px 0 #5e3c76;
}
body[data-theme="crimson-black"] .inspection-history-table thead th{
  box-shadow:inset 0 -1px 0 #5a2a3a;
}
body[data-theme="dracula"] .inspection-history-table tbody tr:hover td{
  background:rgba(167,139,250,.1);
}
body[data-theme="crimson-black"] .inspection-history-table tbody tr:hover td{
  background:rgba(251,113,133,.1);
}
body[data-theme="dracula"] .insp-status-pill.danger{
  background:#4a2637;
  color:#fecdd3;
  border:1px solid #be185d;
}
body[data-theme="crimson-black"] .insp-status-pill.danger{
  background:#4b1f2b;
  color:#ffe4ea;
  border:1px solid #fb7185;
}
body[data-theme="dracula"] .wmr-modal .wmr-section{
  box-shadow:inset 0 1px 0 rgba(167,139,250,.2);
}
body[data-theme="crimson-black"] .wmr-modal .wmr-section{
  box-shadow:inset 0 1px 0 rgba(251,113,133,.2);
}
body[data-theme="dracula"] .wmr-modal .stage-input:focus{
  border-color:#a78bfa;
  box-shadow:0 0 0 2px rgba(167,139,250,.25);
}
body[data-theme="crimson-black"] .wmr-modal .stage-input:focus{
  border-color:#fb7185;
  box-shadow:0 0 0 2px rgba(251,113,133,.25);
}
body[data-theme="dracula"] .wmr-modal .detail-table thead th{
  box-shadow:inset 0 -1px 0 #5e3c76;
}
body[data-theme="crimson-black"] .wmr-modal .detail-table thead th{
  box-shadow:inset 0 -1px 0 #5a2a3a;
}
body[data-theme="dracula"] .wmr-modal .detail-table tbody tr:hover td{
  background:rgba(167,139,250,.08);
}
body[data-theme="crimson-black"] .wmr-modal .detail-table tbody tr:hover td{
  background:rgba(251,113,133,.08);
}
@media (max-width: 700px){
  .theme-preview-grid{grid-template-columns:repeat(2,minmax(0,1fr))}
}
.view-enter{
  opacity:0;
  transform:translateY(10px);
  animation:viewEnter .36s cubic-bezier(.2,.75,.25,1) forwards;
  animation-delay:var(--enter-delay,0ms);
}
@keyframes viewEnter{
  to{
    opacity:1;
    transform:translateY(0);
  }
}
@media (prefers-reduced-motion: reduce){
  .view-enter{
    opacity:1;
    transform:none;
    animation:none;
  }
}
/* UNIVERSAL MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(15,23,42,.45);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;z-index:200}
.modal{background:var(--modal-bg);border:1px solid var(--modal-border);border-radius:16px;box-shadow:0 25px 50px rgba(0,0,0,.2);width:90%;max-width:420px;padding:20px;display:flex;flex-direction:column;gap:12px;animation:pop .25s ease}
.modal h3{margin:0;font-size:16px}
.modal p{margin:0;font-size:13px;color:var(--tm);white-space:pre-line}
.modal-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:6px}
.modal-btn{border:0;border-radius:999px;padding:8px 14px;font-weight:600;cursor:pointer}
.modal-btn.primary{background:var(--btn-primary-bg);color:var(--btn-primary-text)}
.modal-btn.secondary{background:var(--btn-secondary-bg);color:var(--btn-secondary-text)}
@keyframes pop{from{transform:scale(.95);opacity:0}to{transform:scale(1);opacity:1}}

/* Floating add button */
.fab{
  position:fixed;
  bottom:20px;
  right:20px;
  width:48px;
  height:48px;
  border-radius:50%;
  border:1px solid var(--ah);
  background:linear-gradient(135deg,var(--a) 0%,var(--ah) 100%);
  color:#ffffff;
  display:grid;
  place-items:center;
  box-shadow:0 10px 22px rgba(15,23,42,.3);
  cursor:pointer;
  z-index:60;
  transition:transform .18s ease, box-shadow .22s ease;
}
.fab:hover{
  transform:translateY(-1px);
  box-shadow:0 14px 26px rgba(15,23,42,.38);
}
.fab:focus-visible{
  outline:none;
  box-shadow:var(--fab-focus-ring);
}
.fab svg{width:22px;height:22px;fill:currentColor}

/* Compact floating ICS form - restored (darker SaaS style) */
.sheet{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:-100%;
  width:78%;
  max-width:900px;
  min-height:160px;

  background:var(--sheet-bg);
  border:1px solid var(--sheet-border);
  border-radius:12px;

  box-shadow:var(--sheet-shadow);

  padding:14px 16px 16px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
  align-items:start;

  transition:.3s;
  z-index:70;
}

.sheet.show{bottom:20px}

.form-col{
  display:flex;
  flex-direction:column;
  gap:6px;
}

.form-col h4{
  margin:0;
  font-size:12px;
  font-weight:700;
  color:var(--sheet-heading);
}

.row{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:8px;
}

.row-2{
  display:grid;
  grid-template-columns:minmax(220px,2.2fr) minmax(120px,1fr) minmax(130px,1fr);
  gap:8px;
}

.sheet label{
  font-size:10px;
  font-weight:600;
  color:var(--sheet-label);
}

.sheet input{
  width:100%;
  padding:6px 8px;
  border-radius:8px;
  border:1px solid var(--sheet-input-border);
  font-size:12px;
  background:var(--sheet-input-bg);
  color:var(--sheet-input-text);
}

.row-2 .name-field{min-width:0}

@media (max-width: 900px){
  .sheet{
    width:95%;
    grid-template-columns:1fr;
    gap:12px;
  }
  .row{grid-template-columns:1fr}
  .row-2{
    grid-template-columns:1fr 1fr;
  }
  .row-2 .name-field{
    grid-column:1 / -1;
  }
}

.sheet input::placeholder{color:var(--sheet-input-placeholder)}

@media (max-width: 1100px){
  .dash-grid{grid-template-columns:repeat(3,minmax(0,1fr))}
  .dash-panels,.dash-2col,.dash-story,.dash-analytics{grid-template-columns:1fr}
}

@media (max-width: 700px){
  .dash-grid{grid-template-columns:repeat(2,minmax(0,1fr))}
  .welcome-title{font-size:24px}
  .welcome-subtitle{font-size:13px}
  .dash-mini-metrics{grid-template-columns:1fr}
  .dash-hero-graphic{display:none}
  .dash-bar-row{grid-template-columns:78px 1fr auto}
}

@media (max-width: 980px){
  .app-shell{
    grid-template-columns:1fr;
    gap:10px;
    padding:10px;
  }
  .app-sidebar{
    position:relative;
    top:auto;
    height:auto;
  }
  .sidebar-nav{
    flex-direction:row;
    flex-wrap:wrap;
    gap:8px;
  }
  .sidebar-nav .item{
    flex:1 1 calc(50% - 8px);
    justify-content:center;
  }
  .app-topbar{
    top:10px;
  }
  .topbar-title{
    display:none;
  }
  .top-user-meta{
    display:none;
  }
}
@media (max-width: 640px){
  .app-shell{
    padding:8px;
    gap:8px;
  }
  .app-sidebar{
    padding:10px;
    border-radius:14px;
  }
  .brand{
    padding:6px 6px 8px;
  }
  .logo{
    width:32px;
    height:32px;
    border-radius:10px;
  }
  .sidebar-nav{
    gap:6px;
  }
  .sidebar-nav .item{
    flex:1 1 100%;
    justify-content:flex-start;
    padding:8px 10px;
  }
  .sidebar-foot{
    display:none;
  }
  .app-topbar{
    height:52px;
    padding:0 10px;
    border-radius:12px;
  }
  .right{
    gap:6px;
  }
  .icon-btn{
    width:30px;
    height:30px;
    border-radius:9px;
  }
  .fab{
    width:42px;
    height:42px;
  }
  .main{
    padding:4px 2px 16px;
    gap:10px;
  }
  .welcome-title{
    font-size:22px;
  }
  .dash-grid{
    grid-template-columns:1fr;
  }
  .dash-trend-chart{
    gap:4px;
    padding-left:0;
    padding-right:0;
  }
  .dash-trend-label{
    font-size:9px;
  }
}

.sheet input:focus{
  outline:none;
  border-color:var(--sheet-input-focus-border);
  box-shadow:var(--sheet-input-focus-ring);
}

.form-action{
  position:absolute;
  top:12px;
  right:16px;
}
.form-alert{
  grid-column:1 / -1;
  margin-top:4px;
  padding:8px 10px;
  border-radius:8px;
  font-size:12px;
  font-weight:600;
  display:none;
}
.form-alert.show{display:block}
.form-alert.error{
  background:#fee2e2;
  border:1px solid #fecaca;
  color:#991b1b;
}
.form-alert.info{
  background:#eff6ff;
  border:1px solid #bfdbfe;
  color:#1d4ed8;
}

.add-btn{
  background:var(--a);
  color:#fff;
  border:0;
  padding:5px 12px;
  border-radius:7px;
  font-weight:600;
  font-size:11px;

  opacity:.6;
  pointer-events:auto;
  transition:.15s;
}

.add-btn.enabled{
  opacity:1;
  pointer-events:auto;
}

.add-btn:hover.enabled{background:var(--ah)}
</style>
</head>
<body>

<div class="app-shell">
  <aside class="app-sidebar">
    <div class="brand">
      <div class="logo" id="appLogo">OES</div>
      <div class="brand-copy">
        <span class="brand-title">Digital School Inventory</span>
        <span class="brand-sub" id="brandSub">System Manager</span>
      </div>
    </div>
    <nav class="nav sidebar-nav">
      <div class="item active" data-view="Dashboard"><span class="nav-ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 13h8V3H3v10zm10 8h8V11h-8v10zM3 21h8v-6H3v6zm10-10h8V3h-8v8z"/></svg></span><span>Dashboard</span></div>
      <div class="item" data-view="Manage Inventory"><span class="nav-ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 4h16v2H4V4zm0 4h16v12H4V8zm3 3v2h4v-2H7zm0 4v2h10v-2H7z"/></svg></span><span>Inventory</span></div>
      <div class="item" data-view="Action Center"><span class="nav-ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2 2 7l10 5 8.35-4.18v6.43h1.5V7L12 2zm-6.5 10.4V17L12 20l6.5-3v-4.6L12 15.5 5.5 12.4z"/></svg></span><span>Actions</span></div>
      <div class="item" data-view="Archives"><span class="nav-ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 3h18v4H3V3zm2 6h14v12H5V9zm3 3v2h8v-2H8z"/></svg></span><span>Archives</span></div>
    </nav>
    <div class="sidebar-foot">
      <div class="sidebar-install">
        <button id="installAppBtn" class="small-btn add sidebar-install-btn" type="button" onclick="installPWAApp()">Install App</button>
      </div>
      <div class="sidebar-profile">
        <div class="sidebar-profile-main">
          <div class="sidebar-profile-left">
            <span class="sidebar-profile-avatar" id="sidebarUserAvatar">CU</span>
            <button class="sidebar-profile-identity" id="sidebarProfileBtn" title="Open Profile" aria-label="Open Profile">
              <div class="sidebar-profile-name" id="sidebarUserName">Custodian</div>
              <div class="sidebar-profile-role" id="sidebarUserRole">Inventory Officer</div>
            </button>
          </div>
          <button class="sidebar-signout-icon" id="sidebarSignOutIconBtn" title="Sign Out" aria-label="Sign Out">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M13 3h-2v10h2V3zm3.66 2.34-1.42 1.42A7 7 0 1 1 12 5V3a9 9 0 1 0 6.36 2.64l-1.7-1.3z"/></svg>
          </button>
        </div>
      </div>
    </div>
  </aside>
  <div class="app-main">
    <header class="app-topbar">
      <div class="topbar-title" id="topSchoolTitle">Oquendo Elementary School</div>
      <div class="right">
        <div class="icon-btn" id="searchBtn" title="Search (Ctrl+K)">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M15.5 14h-.79l-.28-.27a6 6 0 1 0-.7.7l.27.28v.79L19 20.49 20.49 19 15.5 14zM10 14a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>
        </div>
        <div class="icon-btn" id="dataManagerBtn" aria-label="Data Manager" title="Data Manager (Alt+D)">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2h4a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5zm2 0v2h8V5H5zm0 4v10h14V9H5zm2 3h6v2H7v-2zm0 4h8v2H7v-2z"/></svg>
        </div>
        <div class="notif-wrap">
          <div class="icon-btn" id="notifBellBtn">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 22a2.5 2.5 0 0 0 2.45-2h-4.9A2.5 2.5 0 0 0 12 22zm6-6V11a6 6 0 1 0-12 0v5L4 18v1h16v-1l-2-2z"/></svg>
          </div>
          <div class="notif-badge" id="notifBadge">0</div>
          <div class="notif-panel" id="notifPanel">
            <div class="notif-head">Notifications</div>
            <div class="notif-empty">No notifications yet.</div>
          </div>
        </div>
      </div>
    </header>

<main class="main" id="content">
  <h1>Dashboard</h1>
  <p>Standalone shell. Content loads here.</p>
</main>
</div>
</div>
<!-- UNIVERSAL MODAL -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <h3 id="modalTitle">Message</h3>
    <p id="modalMsg"></p>
    <div class="modal-actions"></div>
  </div>
</div>

<div class="fab" onclick="toggleSheet()" aria-label="Open ICS form">
  <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M19 11H13V5h-2v6H5v2h6v6h2v-6h6v-2z"/></svg>
</div>

<div class="sheet" id="sheet">
  <div class="form-col">
    <h4>Agency Info</h4>
    <label>ENTITY NAME</label>
    <input id="entityName" list="entityNameList" placeholder="Enter or search entity name" />
    <div class="row">
      <div>
        <label>FUND CLUSTER</label>
        <input id="fundCluster" list="fundClusterList" placeholder="Cluster" />
      </div>
      <div>
        <label>ICS NO.</label>
        <input id="icsNo" placeholder="YYYY-MM-XXX" maxlength="11" inputmode="numeric" autocomplete="off" />
      </div>
    </div>
  </div>
  <div class="form-col">
    <h4>Signatories</h4>
    <label>ISSUED BY</label>
    <div class="row-2">
      <input id="issuedByName" list="issuedByNameList" class="name-field" placeholder="Name" />
      <input id="issuedByPos" list="issuedByPosList" class="pos-field" placeholder="Designation" />
      <input id="issuedByDate" class="date-field" type="date" />
    </div>
    <label>RECEIVED BY</label>
    <div class="row-2">
      <input id="receivedByName" list="receivedByNameList" class="name-field" placeholder="Name" />
      <input id="receivedByPos" list="receivedByPosList" class="pos-field" placeholder="Designation" />
      <input id="receivedByDate" class="date-field" type="date" />
    </div>
  </div>
  <div class="form-action">
    <button class="add-btn">ADD ICS</button>
  </div>
  <div class="form-alert" id="formAlert"></div>
</div>
<input id="icsImportInput" type="file" accept=".json,application/json" style="display:none" onchange="handleImportFile(event)" />
<input id="dataManagerImportInput" type="file" accept=".json,application/json" style="display:none" onchange="handleDataManagerFile(event)" />
<input id="dataManagerValidateInput" type="file" accept=".json,application/json" style="display:none" onchange="handleDataManagerValidateFile(event)" />
<datalist id="entityNameList"></datalist>
<datalist id="fundClusterList"></datalist>
<datalist id="issuedByNameList"></datalist>
<datalist id="issuedByPosList"></datalist>
<datalist id="receivedByNameList"></datalist>
<datalist id="receivedByPosList"></datalist>
<datalist id="stageDescList"></datalist>
<datalist id="stageUnitList"></datalist>
<div class="search-overlay" id="searchOverlay">
  <div class="search-box">
    <input id="searchInput" class="search-input" placeholder="Search ICS No., entity, accountable person, item description, item no..." />
    <div class="search-results" id="searchResults">
      <div class="search-empty">Type to search ICS records.</div>
    </div>
  </div>
</div>
<div class="actions-modal-overlay" id="icsDetailsOverlay">
  <div class="actions-modal modal-xl ics-details-modal">
    <div class="modal-head actions-hero" style="margin:0">
      <h3 id="icsDetailsTitle">ICS Details</h3>
      <button class="small-btn add" onclick="closeICSDetailsModal()">Close</button>
    </div>
    <div class="modal-body" id="icsDetailsBody"></div>
  </div>
</div>
<div class="actions-modal-overlay" id="archivedHistoryOverlay">
  <div class="actions-modal modal-lg archived-history-modal">
    <div class="modal-head actions-hero" style="margin:0">
      <h3 id="archivedHistoryTitle">Archived Item History</h3>
      <button class="archived-history-close" aria-label="Close archived history" onclick="closeArchivedHistoryModal()">x</button>
    </div>
    <div class="modal-body" id="archivedHistoryBody"></div>
  </div>
</div>
<div class="actions-modal-overlay setup-overlay" id="setupOverlay">
  <div class="actions-modal setup-modal">
    <div class="modal-head">
      <h3>Setup School Workspace</h3>
      <p class="modal-sub">Create school identity and first personnel profile for this device.</p>
    </div>
    <div class="modal-body">
      <div class="profile-grid modal-form">
        <div class="full profile-section">
          <p class="profile-section-title">1) School</p>
          <div class="profile-grid">
            <div class="full">
              <label>School Name</label>
              <input id="setupSchoolName" class="stage-input" placeholder="Oquendo Elementary School" />
            </div>
            <div>
              <label>School ID</label>
              <input id="setupSchoolId" class="stage-input" inputmode="numeric" maxlength="12" placeholder="114656" />
            </div>
          </div>
        </div>
        <div class="full profile-section">
          <p class="profile-section-title">2) Personnel Profile</p>
          <div class="profile-grid">
            <div class="full">
              <label>Full Name</label>
              <input id="setupProfileName" class="stage-input" placeholder="Custodian Name" />
            </div>
            <div>
              <label>Designation</label>
              <select id="setupProfileDesignation" class="stage-input">
                <option value="">Select designation</option>
              </select>
            </div>
            <div>
              <label>Access Role</label>
              <select id="setupProfileRole" class="stage-input">
                <option value="encoder">Encoder</option>
                <option value="viewer">Viewer</option>
                <option value="admin">Admin</option>
              </select>
            </div>
            <div>
              <label>Email</label>
              <input id="setupProfileEmail" class="stage-input" placeholder="name@example.com" />
            </div>
          </div>
        </div>
      </div>
      <p class="setup-hint" id="setupHint">Complete setup to continue.</p>
    </div>
    <div class="modal-foot">
      <div class="ics-card-actions" style="justify-content:flex-end">
        <button class="small-btn finalize" onclick="submitInitialSetup()">Create School and Continue</button>
      </div>
    </div>
  </div>
</div>
<div class="actions-modal-overlay" id="loginOverlay">
  <div class="actions-modal modal-sm">
    <div class="modal-head">
      <h3>User Login</h3>
      <p class="modal-sub">Enter School ID and select a profile for this device session.</p>
    </div>
    <div class="modal-body modal-form">
      <label>School ID</label>
      <input id="loginSchoolId" class="stage-input" inputmode="numeric" maxlength="12" placeholder="114656" />
      <label style="margin-top:8px">Profile</label>
      <select id="loginProfileSelect" class="stage-input">
        <option value="">Select profile</option>
      </select>
      <label style="display:flex;align-items:center;gap:8px;margin-top:8px">
        <input id="loginRememberDevice" type="checkbox" checked />
        <span>Remember this device</span>
      </label>
      <p class="login-hint" id="loginHint">Login required to continue.</p>
    </div>
    <div class="modal-foot">
      <div class="ics-card-actions" style="justify-content:space-between">
        <button class="small-btn add" onclick="openPersonnelSignupFromLogin()">New Personnel</button>
        <button class="small-btn finalize" id="loginSubmitBtn" onclick="submitLogin()">Login</button>
      </div>
    </div>
  </div>
</div>
<div class="actions-modal-overlay" id="profileOverlay">
  <div class="actions-modal modal-lg">
    <div class="modal-head">
      <h3>User Profile</h3>
      <p class="modal-sub">Manage identity and personal workspace preferences.</p>
    </div>
    <div class="modal-body">
      <div class="profile-shell">
        <aside class="profile-side">
          <p class="profile-side-title">Settings</p>
          <div class="profile-side-menu" id="profileSideMenu">
            <button type="button" class="profile-menu-btn active" data-profile-tab="identity" aria-selected="true">Identity</button>
            <button type="button" class="profile-menu-btn" data-profile-tab="school" aria-selected="false">School Lock</button>
            <button type="button" class="profile-menu-btn" data-profile-tab="preferences" aria-selected="false">Preferences</button>
            <button type="button" class="profile-menu-btn" data-profile-tab="security" aria-selected="false">Security</button>
          </div>
          <div class="profile-side-meta">
            <div>
              <div class="k">Active Profile Key</div>
              <div class="v" id="profileMenuProfileKey">-</div>
            </div>
            <div>
              <div class="k">Session School ID</div>
              <div class="v" id="profileMenuSchoolId">-</div>
            </div>
          </div>
        </aside>
        <div class="profile-content modal-form">
          <div class="profile-head">
            <div style="display:flex;align-items:center;gap:10px">
              <span class="profile-avatar-preview" id="profileAvatarPreview">CU</span>
              <div class="profile-head-meta">
                <p class="profile-head-title">Workspace Profile</p>
                <p class="profile-head-sub">Initials are auto-generated from Full Name.</p>
              </div>
            </div>
            <p class="profile-head-sub" id="profileLastLogin">Last login: -</p>
          </div>
          <div class="profile-pane active" data-profile-pane="identity">
            <div class="profile-section">
              <p class="profile-section-title">Identity</p>
              <div class="profile-grid">
                <div class="full">
                  <label>Full Name</label>
                  <input id="profileName" class="stage-input" placeholder="Custodian Name" />
                </div>
                <div class="full">
                  <label>Avatar Icon</label>
                  <input id="profileAvatarType" type="hidden" value="initials" />
                  <div class="avatar-picker" id="profileAvatarPicker">
                    <button type="button" class="avatar-picker-btn" data-avatar="initials" title="Initials"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 19h16v2H4v-2zm2-2V5h4.5a4.5 4.5 0 0 1 0 9H8v3H6zm2-5h2.5a2.5 2.5 0 0 0 0-5H8v5zm7.5-7h2l4.5 12h-2.1l-1.1-3h-4.6l-1.1 3h-2.1L15.5 5zm.4 7h3.2L17 7.2 15.9 12z"/></svg></button>
                    <button type="button" class="avatar-picker-btn" data-avatar="person" title="Person"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm0 2c-4.4 0-8 2-8 4.5V21h16v-2.5C20 16 16.4 14 12 14z"/></svg></button>
                    <button type="button" class="avatar-picker-btn" data-avatar="briefcase" title="Briefcase"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M9 4h6a2 2 0 0 1 2 2v2h3a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h3V6a2 2 0 0 1 2-2zm0 4h6V6H9v2zm-5 4v6h16v-6h-6v2h-4v-2H4z"/></svg></button>
                    <button type="button" class="avatar-picker-btn" data-avatar="school" title="School"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3 2 8l10 5 8-4v6h2V8L12 3zm-6 9v6h12v-6l-6 3-6-3zm3 1.5 3 1.5 3-1.5V17H9v-3.5z"/></svg></button>
                    <button type="button" class="avatar-picker-btn" data-avatar="shield" title="Shield"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2 4 5v6c0 5.3 3.4 9.9 8 11 4.6-1.1 8-5.7 8-11V5l-8-3zm0 2.2 6 2.2V11c0 4.2-2.5 7.9-6 9-3.5-1.1-6-4.8-6-9V6.4l6-2.2z"/></svg></button>
                    <button type="button" class="avatar-picker-btn" data-avatar="star" title="Star"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="m12 2 3.1 6.3 6.9 1-5 4.9 1.2 6.9L12 17.8 5.8 21.1 7 14.2 2 9.3l6.9-1L12 2z"/></svg></button>
                  </div>
                </div>
                <div>
                  <label>Designation</label>
                  <select id="profileDesignation" class="stage-input">
                    <option value="">Select designation</option>
                  </select>
                </div>
                <div>
                  <label>Access Role</label>
                  <select id="profileRole" class="stage-input">
                    <option value="encoder">Encoder</option>
                    <option value="viewer">Viewer</option>
                    <option value="admin">Admin</option>
                  </select>
                </div>
                <div>
                  <label>Email</label>
                  <input id="profileEmail" class="stage-input" placeholder="name@example.com" />
                </div>
              </div>
            </div>
          </div>
          <div class="profile-pane" data-profile-pane="school">
            <div class="profile-section">
              <p class="profile-section-title">School Identity Lock</p>
              <div class="profile-grid">
                <div class="full">
                  <label>School Name</label>
                  <input id="profileSchoolName" class="stage-input" placeholder="Oquendo Elementary School" />
                </div>
                <div>
                  <label>School ID</label>
                  <input id="profileSchoolId" class="stage-input" inputmode="numeric" maxlength="12" placeholder="114656" />
                </div>
                <div class="full">
                  <label>School Logo</label>
                  <div class="profile-grid">
                    <div class="full">
                      <input id="profileSchoolLogoInput" type="file" class="stage-input" accept="image/png,image/jpeg,image/webp,image/svg+xml" />
                    </div>
                    <div class="full" style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
                      <button type="button" class="small-btn del" id="profileSchoolLogoRemoveBtn" onclick="clearSchoolLogoDraft()">Remove Logo</button>
                      <span class="profile-head-sub" id="profileSchoolLogoHint">No logo selected.</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="profile-pane" data-profile-pane="preferences">
            <div class="profile-section">
              <p class="profile-section-title">Preferences</p>
              <div class="profile-grid">
                <div>
                  <label>Default View</label>
                  <select id="profileDefaultView" class="stage-input">
                    <option value="Dashboard">Dashboard</option>
                    <option value="Manage Inventory">Manage Inventory</option>
                    <option value="Action Center">Action Center</option>
                    <option value="Archives">Archives</option>
                  </select>
                </div>
                <div>
                  <label>Table Density</label>
                  <select id="profileDensity" class="stage-input">
                    <option value="comfortable">Comfortable</option>
                    <option value="compact">Compact</option>
                  </select>
                </div>
                <div class="full">
                  <label>Theme Style</label>
                  <input id="profileAccent" type="hidden" value="elegant-white" />
                </div>
                <div class="full theme-preview-grid" id="profileThemePreview">
                  <button type="button" class="theme-preview-btn" data-theme="playful"><span class="theme-name">Playful</span><span class="theme-swatches"><i></i><i></i><i></i></span></button>
                  <button type="button" class="theme-preview-btn" data-theme="elegant-white"><span class="theme-name">Elegant White</span><span class="theme-swatches"><i></i><i></i><i></i></span></button>
                  <button type="button" class="theme-preview-btn" data-theme="elegant-green"><span class="theme-name">Elegant Green</span><span class="theme-swatches"><i></i><i></i><i></i></span></button>
                  <button type="button" class="theme-preview-btn" data-theme="velvet-red"><span class="theme-name">Velvet Red</span><span class="theme-swatches"><i></i><i></i><i></i></span></button>
                  <button type="button" class="theme-preview-btn" data-theme="crimson-black"><span class="theme-name">Crimson Black</span><span class="theme-swatches"><i></i><i></i><i></i></span></button>
                  <button type="button" class="theme-preview-btn" data-theme="nord"><span class="theme-name">Nord</span><span class="theme-swatches"><i></i><i></i><i></i></span></button>
                  <button type="button" class="theme-preview-btn" data-theme="dracula"><span class="theme-name">Dracula</span><span class="theme-swatches"><i></i><i></i><i></i></span></button>
                </div>
              </div>
            </div>
          </div>
          <div class="profile-pane" data-profile-pane="security">
            <div class="profile-section">
              <p class="profile-section-title">Security and Traceability</p>
              <div class="profile-grid">
                <div>
                  <label>Profile Key (Read-only)</label>
                  <div class="profile-readonly" id="profileKeyReadonly">-</div>
                </div>
                <div>
                  <label>Current Session</label>
                  <div class="profile-readonly" id="profileSessionReadonly">Not logged in</div>
                </div>
                <div class="full">
                  <label>History Trace</label>
                  <div class="profile-readonly">Record and item history exports include actor profile key metadata.</div>
                </div>
                <div class="full">
                  <label>Data Integrity Check</label>
                  <div class="profile-readonly" id="profileTraceIntegritySummary">Trace integrity check pending.</div>
                  <div style="margin-top:8px">
                    <button id="profileTraceRepairBtn" type="button" class="small-btn add" onclick="repairLocalTraceIntegrity()">Repair Missing Profile Keys</button>
                    <button id="profileTraceUndoBtn" type="button" class="small-btn add" onclick="undoLastDataChange()" style="margin-left:8px">Undo Last Data Change</button>
                  </div>
                </div>
                <div class="full">
                  <label>Recent Data Activity</label>
                  <div class="profile-readonly" id="profileRecentDataActivity">No recent maintenance/import/export actions.</div>
                </div>
                <div class="full">
                  <label>Designation List (School-wide)</label>
                  <div class="profile-grid">
                    <div>
                      <input id="designationNewInput" class="stage-input" placeholder="Add designation (Admin only)" />
                    </div>
                    <div>
                      <button id="designationAddBtn" type="button" class="small-btn add" onclick="addDesignationFromProfile()">Add Designation</button>
                    </div>
                    <div class="full profile-readonly" id="designationListReadonly">No designations configured.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-foot">
      <div class="ics-card-actions">
        <button class="small-btn del" onclick="signOutSession()">Sign Out</button>
        <button class="small-btn add" onclick="closeProfileModal()">Cancel</button>
        <button class="small-btn finalize" onclick="saveProfileSettings()">Save</button>
      </div>
    </div>
  </div>
</div>
<div class="actions-modal-overlay" id="dataHubOverlay">
  <div class="actions-modal modal-sm">
    <div class="modal-head">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
        <h3>Data Hub</h3>
        <button class="small-btn add" onclick="closeDataHubModal()">Close</button>
      </div>
      <p class="modal-sub">Choose the task you want to perform.</p>
    </div>
    <div class="modal-body">
      <div class="dm-hub-actions">
        <button class="dm-hub-btn" type="button" onclick="openDataImportModal()">
          <span class="dm-hub-ico import" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M19 15v4H5v-4H3v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4h-2zM11 5.83V17h2V5.83l3.59 3.58L18 8l-6-6-6 6 1.41 1.41L11 5.83z"/></svg></span>
          <strong>Import Center</strong>
          <span>Validate a JSON file, review conflicts, and apply merge/replace import.</span>
        </button>
        <button class="dm-hub-btn" type="button" onclick="openDataExportModal()">
          <span class="dm-hub-ico export" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zM11 4v11H8l4 4 4-4h-3V4h-2z"/></svg></span>
          <strong>Export Center</strong>
          <span>Export filtered records package or full unfiltered workspace backup.</span>
        </button>
        <button class="dm-hub-btn" type="button" onclick="openAutoPopulateFromDataHub()">
          <span class="dm-hub-ico export" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M19 11h-6V5h-2v6H5v2h6v6h2v-6h6v-2z"/></svg></span>
          <strong>Auto-Populate x3</strong>
          <span>Generate 3 sample ICS records for stress testing and demo data.</span>
        </button>
      </div>
    </div>
  </div>
</div>
<div class="actions-modal-overlay" id="dataImportOverlay">
  <div class="actions-modal modal-xl">
    <div class="modal-head">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
        <h3>Import Center</h3>
        <button class="small-btn add" onclick="closeDataImportModal()">Close</button>
      </div>
      <p class="modal-sub">Schema-validated import with preview, merge/replace control, and conflict reporting.</p>
    </div>
    <div class="modal-body">
      <div class="dm-layout">
        <section class="dm-section">
          <div class="dm-section-head">
            <h4>1) Import Source</h4>
            <p>Select a JSON package to validate and preview before applying.</p>
          </div>
          <div class="data-manager-bar">
            <button class="small-btn add" type="button" onclick="triggerDataManagerFile()">Choose JSON File</button>
            <button class="small-btn add" type="button" onclick="triggerDataManagerValidateFile()">Validate JSON Trace</button>
            <div class="data-manager-file" id="dmFileName">No file selected.</div>
          </div>
        </section>

        <section class="dm-section" id="dmStep3Section">
          <div class="dm-section-head" style="margin-bottom:4px">
            <h4>2) Import Rules and Result</h4>
            <span class="dm-step-mark" id="dmStep3Mark">Ready to Apply</span>
          </div>
          <p class="dm-muted" style="margin:0 0 8px">Choose how duplicate ICS numbers should be handled.</p>
          <div class="data-manager-mode">
            <label><input type="radio" name="dmMode" value="merge" checked /> Merge (skip duplicate ICS)</label>
            <label><input type="radio" name="dmMode" value="replace" /> Replace (overwrite duplicate ICS)</label>
          </div>
          <div class="dm-inline-status" id="dmInlineStatus"></div>
          <p class="dm-muted">After choosing a file, open Validation Preview to review rows and conflicts before applying import.</p>
        </section>

        <section class="dm-section">
          <div class="dm-section-head">
            <h4>3) Recent Import Activity</h4>
            <p>Last import actions from this device.</p>
          </div>
          <ul class="dm-history-list" id="dmImportHistoryList">
            <li><span class="dm-history-time">No import history yet.</span></li>
          </ul>
        </section>
      </div>
    </div>
    <div class="modal-foot">
      <div class="ics-card-actions dm-foot-actions">
        <div class="dm-foot-left">
          <button class="small-btn dm-switch-btn" onclick="openDataExportModal()">Open Export Center</button>
        </div>
        <div class="dm-foot-right">
          <button class="small-btn finalize" onclick="openDataValidationModal()">Open Validation Preview</button>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="actions-modal-overlay" id="dataValidationOverlay">
  <div class="actions-modal modal-xl">
    <div class="modal-head">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
        <h3>Validation Preview</h3>
        <button class="small-btn add" onclick="closeDataValidationModal()">Close</button>
      </div>
      <p class="modal-sub">Review validation results and conflicts before applying import.</p>
    </div>
    <div class="modal-body">
      <p class="dm-muted" id="dmSummaryText">Load a JSON package to preview validation results.</p>
      <div class="dm-verify-panel info" id="dmVerificationStatus">Restore verification pending. Load a JSON package.</div>
      <div class="dm-kpis" id="dmKpis">
        <div class="dm-kpi"><div class="k">Incoming</div><div class="v">0</div></div>
        <div class="dm-kpi"><div class="k">Valid</div><div class="v">0</div></div>
        <div class="dm-kpi"><div class="k">Invalid</div><div class="v">0</div></div>
        <div class="dm-kpi"><div class="k">New</div><div class="v">0</div></div>
        <div class="dm-kpi"><div class="k">Conflicts</div><div class="v">0</div></div>
        <div class="dm-kpi"><div class="k">In-file Duplicates</div><div class="v">0</div></div>
      </div>
      <div class="detail-table-wrap">
        <table class="dm-preview-table">
          <thead>
            <tr><th>#</th><th>ICS No.</th><th>Entity</th><th>Status</th><th>Notes</th></tr>
          </thead>
          <tbody id="dmPreviewBody">
            <tr><td colspan="5" class="empty-cell">No preview yet.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="modal-foot">
      <div class="ics-card-actions dm-foot-actions">
        <div class="dm-foot-left">
          <button class="small-btn add" onclick="openDataImportModal()">Back to Import Center</button>
          <button class="small-btn add" onclick="openDataManagerMigrationReport()">Migration Details</button>
          <button class="small-btn add" onclick="downloadDataManagerConflictReport()">Download Conflict Report</button>
        </div>
        <div class="dm-foot-right">
          <button class="small-btn finalize" id="dmApplyImportBtn" onclick="applyDataManagerImport()" disabled>Apply Import</button>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="actions-modal-overlay" id="dataExportOverlay">
  <div class="actions-modal modal-lg">
    <div class="modal-head">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
        <h3>Export Center</h3>
        <button class="small-btn add" onclick="closeDataExportModal()">Close</button>
      </div>
      <p class="modal-sub">Export records package by period or full unfiltered workspace backup.</p>
    </div>
    <div class="modal-body">
      <div class="dm-layout">
        <section class="dm-section">
          <div class="dm-section-head">
            <h4>1) Export Filters</h4>
            <p>Year/Month filters apply to Records Package only.</p>
          </div>
          <div class="data-manager-export-filters">
            <label>Export Year
              <select id="dmExportYear" class="stage-input">
                <option value="all">All Years</option>
              </select>
            </label>
            <label>Export Month
              <select id="dmExportMonth" class="stage-input">
                <option value="all">All Months</option>
                <option value="01">January</option>
                <option value="02">February</option>
                <option value="03">March</option>
                <option value="04">April</option>
                <option value="05">May</option>
                <option value="06">June</option>
                <option value="07">July</option>
                <option value="08">August</option>
                <option value="09">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
              </select>
            </label>
          </div>
          <p class="dm-muted" id="dmExportFilterHint" style="margin:8px 0 8px">Records export filter: All records.</p>
        </section>
        <section class="dm-section">
          <div class="dm-section-head">
            <h4>2) Export Actions</h4>
            <p>Choose records-only export or full backup.</p>
          </div>
          <div class="dm-export-actions" style="margin-top:0">
            <button class="small-btn add" type="button" onclick="exportSchemaVersionedData('records')">Export Records Package</button>
            <button class="small-btn add" type="button" onclick="exportSchemaVersionedData('full')">Export Full Package</button>
          </div>
          <p class="dm-muted" style="margin:8px 0 0">
            <strong>Export Records Package:</strong> exports ICS records only and applies the selected Year/Month filter.
            <br />
            <strong>Export Full Package:</strong> exports the complete workspace backup (records, archives, notifications, and audit logs) without filters.
          </p>
        </section>
      </div>
    </div>
    <div class="modal-foot">
      <div class="ics-card-actions dm-foot-actions">
        <div class="dm-foot-left">
          <button class="small-btn dm-switch-btn" onclick="openDataImportModal()">Open Import Center</button>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="./core-storage-security.js"></script>
<script src="./core-shared-utils.js"></script>
<script src="./core-school-profile-normalization.js"></script>
<script src="./core-lineage-audit.js"></script>
<script src="./core-record-normalization.js"></script>
<script src="./core-records-search-details.js"></script>
<script src="./core-inventory-table-render.js"></script>
<script src="./core-printing.js"></script>
<script src="./core-import-autosuggest.js"></script>
<script src="./core-form-staging.js"></script>
<script src="./core-data-manager.js"></script>
<script src="./core-records-workflow.js"></script>
<script src="./core-actions-workflow.js"></script>
<script src="./core-profile-session.js"></script>
<script src="./core-theme-preferences.js"></script>
<script src="./core-school-setup-ui.js"></script>
<script src="./core-profile-modal.js"></script>
<script src="./core-app-bootstrap.js"></script>
<script src="./core-keyboard-routing.js"></script>
<script src="./core-notifications.js"></script>
<script src="./core-ui-event-wiring.js"></script>
<script src="./core-modal-system.js"></script>
<script src="./core-shell-init.js"></script>
<script src="./core-dashboard-view.js"></script>
<script src="./core-dashboard-render.js"></script>
<script src="./core-inventory-view-render.js"></script>
<script src="./core-actions-view-render.js"></script>
<script src="./core-archives-view-render.js"></script>
<script src="./core-dashboard-actions.js"></script>
<script src="./core-dashboard-metrics.js"></script>
<script src="./core-shell-view-state.js"></script>
<script src="./core-main-entry.js"></script>
</body>
</html>



